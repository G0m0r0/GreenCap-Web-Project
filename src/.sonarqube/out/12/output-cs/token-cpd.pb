§
çC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\AdministrationController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
[		 
	Authorize		 
(		 
Roles		 
=		 
GlobalConstants		 &
.		& '!
AdministratorRoleName		' <
)		< =
]		= >
[

 
Area

 	
(

	 

$str


 
)

 
]

 
public 

class $
AdministrationController )
:* +
BaseController, :
{ 
} 
} Ó
àC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\DashboardController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
public 

class 
DashboardController $
:% &$
AdministrationController' ?
{		 
private

 
readonly

 
ISettingsService

 )
settingsService

* 9
;

9 :
public 
DashboardController "
(" #
ISettingsService# 3
settingsService4 C
)C D
{ 	
this 
. 
settingsService  
=! "
settingsService# 2
;2 3
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
var 
	viewModel 
= 
new 
IndexViewModel  .
{/ 0
SettingsCount1 >
=? @
thisA E
.E F
settingsServiceF U
.U V
GetCountV ^
(^ _
)_ `
,` a
}b c
;c d
return 
this 
. 
View 
( 
	viewModel &
)& '
;' (
} 	
} 
} ëZ
ÖC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\EventsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
EventsController !
:" #$
AdministrationController$ <
{ 
private 
readonly &
IDeletableEntityRepository 3
<3 4
Event4 9
>9 :
context; B
;B C
public 
EventsController 
(  &
IDeletableEntityRepository  :
<: ;
Event; @
>@ A
contextB I
)I J
{ 	
this 
. 
context 
= 
context "
;" #
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
return 
this 
. 
View 
( 
await "
this# '
.' (
context( /
./ 0&
AllAsNoTrackingWithDeleted0 J
(J K
)K L
.L M
ToListAsyncM X
(X Y
)Y Z
)Z [
;[ \
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Details) 0
(0 1
int1 4
?4 5
id6 8
)8 9
{ 	
if 
( 
id 
== 
null 
) 
{ 
return   
this   
.   
NotFound   $
(  $ %
)  % &
;  & '
}!! 
var## 
@event## 
=## 
await## 
this## #
.### $
context##$ +
.##+ ,&
AllAsNoTrackingWithDeleted##, F
(##F G
)##G H
.$$ 
FirstOrDefaultAsync$$ $
($$$ %
m$$% &
=>$$' )
m$$* +
.$$+ ,
Id$$, .
==$$/ 1
id$$2 4
)$$4 5
;$$5 6
if%% 
(%% 
@event%% 
==%% 
null%% 
)%% 
{&& 
return'' 
this'' 
.'' 
NotFound'' $
(''$ %
)''% &
;''& '
}(( 
return** 
this** 
.** 
View** 
(** 
@event** #
)**# $
;**$ %
}++ 	
public.. 
IActionResult.. 
Create.. #
(..# $
)..$ %
{// 	
return00 
this00 
.00 
View00 
(00 
)00 
;00 
}11 	
[66 	
HttpPost66	 
]66 
[77 	$
ValidateAntiForgeryToken77	 !
]77! "
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
Create88) /
(88/ 0
[880 1
Bind881 5
(885 6
$str	886 ú
)
88ú ù
]
88ù û
Event
88ü §
@event
88• ´
)
88´ ¨
{99 	
if:: 
(:: 
this:: 
.:: 

ModelState:: 
.::  
IsValid::  '
)::' (
{;; 
await<< 
this<< 
.<< 
context<< "
.<<" #
AddAsync<<# +
(<<+ ,
@event<<, 2
)<<2 3
;<<3 4
await== 
this== 
.== 
context== "
.==" #
SaveChangesAsync==# 3
(==3 4
)==4 5
;==5 6
return>> 
this>> 
.>> 
RedirectToAction>> ,
(>>, -
nameof>>- 3
(>>3 4
this>>4 8
.>>8 9
Index>>9 >
)>>> ?
)>>? @
;>>@ A
}?? 
returnAA 
thisAA 
.AA 
ViewAA 
(AA 
@eventAA #
)AA# $
;AA$ %
}BB 	
publicEE 
asyncEE 
TaskEE 
<EE 
IActionResultEE '
>EE' (
EditEE) -
(EE- .
intEE. 1
?EE1 2
idEE3 5
)EE5 6
{FF 	
ifGG 
(GG 
idGG 
==GG 
nullGG 
)GG 
{HH 
returnII 
thisII 
.II 
NotFoundII $
(II$ %
)II% &
;II& '
}JJ 
varLL 
@eventLL 
=LL 
awaitLL 
thisLL #
.LL# $
contextLL$ +
.LL+ ,&
AllAsNoTrackingWithDeletedLL, F
(LLF G
)LLG H
.LLH I
FirstOrDefaultAsyncLLI \
(LL\ ]
xLL] ^
=>LL_ a
xLLb c
.LLc d
IdLLd f
==LLg i
idLLj l
)LLl m
;LLm n
ifMM 
(MM 
@eventMM 
==MM 
nullMM 
)MM 
{NN 
returnOO 
thisOO 
.OO 
NotFoundOO $
(OO$ %
)OO% &
;OO& '
}PP 
returnRR 
thisRR 
.RR 
ViewRR 
(RR 
@eventRR #
)RR# $
;RR$ %
}SS 	
[XX 	
HttpPostXX	 
]XX 
[YY 	$
ValidateAntiForgeryTokenYY	 !
]YY! "
publicZZ 
asyncZZ 
TaskZZ 
<ZZ 
IActionResultZZ '
>ZZ' (
EditZZ) -
(ZZ- .
intZZ. 1
idZZ2 4
,ZZ4 5
[ZZ6 7
BindZZ7 ;
(ZZ; <
$str	ZZ< ¢
)
ZZ¢ £
]
ZZ£ §
Event
ZZ• ™
@event
ZZ´ ±
)
ZZ± ≤
{[[ 	
if\\ 
(\\ 
id\\ 
!=\\ 
@event\\ 
.\\ 
Id\\ 
)\\  
{]] 
return^^ 
this^^ 
.^^ 
NotFound^^ $
(^^$ %
)^^% &
;^^& '
}__ 
ifaa 
(aa 
thisaa 
.aa 

ModelStateaa 
.aa  
IsValidaa  '
)aa' (
{bb 
trycc 
{dd 
thisee 
.ee 
contextee  
.ee  !
Updateee! '
(ee' (
@eventee( .
)ee. /
;ee/ 0
awaitff 
thisff 
.ff 
contextff &
.ff& '
SaveChangesAsyncff' 7
(ff7 8
)ff8 9
;ff9 :
}gg 
catchhh 
(hh (
DbUpdateConcurrencyExceptionhh 3
)hh3 4
{ii 
ifjj 
(jj 
!jj 
thisjj 
.jj 
EventExistsjj )
(jj) *
@eventjj* 0
.jj0 1
Idjj1 3
)jj3 4
)jj4 5
{kk 
returnll 
thisll #
.ll# $
NotFoundll$ ,
(ll, -
)ll- .
;ll. /
}mm 
elsenn 
{oo 
throwpp 
;pp 
}qq 
}rr 
returntt 
thistt 
.tt 
RedirectToActiontt ,
(tt, -
nameoftt- 3
(tt3 4
thistt4 8
.tt8 9
Indextt9 >
)tt> ?
)tt? @
;tt@ A
}uu 
returnww 
thisww 
.ww 
Viewww 
(ww 
@eventww #
)ww# $
;ww$ %
}xx 	
public{{ 
async{{ 
Task{{ 
<{{ 
IActionResult{{ '
>{{' (
Delete{{) /
({{/ 0
int{{0 3
?{{3 4
id{{5 7
){{7 8
{|| 	
if}} 
(}} 
id}} 
==}} 
null}} 
)}} 
{~~ 
return 
this 
. 
NotFound $
($ %
)% &
;& '
}
ÄÄ 
var
ÇÇ 
@event
ÇÇ 
=
ÇÇ 
await
ÇÇ 
this
ÇÇ #
.
ÇÇ# $
context
ÇÇ$ +
.
ÇÇ+ ,(
AllAsNoTrackingWithDeleted
ÇÇ, F
(
ÇÇF G
)
ÇÇG H
.
ÉÉ !
FirstOrDefaultAsync
ÉÉ $
(
ÉÉ$ %
m
ÉÉ% &
=>
ÉÉ' )
m
ÉÉ* +
.
ÉÉ+ ,
Id
ÉÉ, .
==
ÉÉ/ 1
id
ÉÉ2 4
)
ÉÉ4 5
;
ÉÉ5 6
if
ÑÑ 
(
ÑÑ 
@event
ÑÑ 
==
ÑÑ 
null
ÑÑ 
)
ÑÑ 
{
ÖÖ 
return
ÜÜ 
this
ÜÜ 
.
ÜÜ 
NotFound
ÜÜ $
(
ÜÜ$ %
)
ÜÜ% &
;
ÜÜ& '
}
áá 
return
ââ 
this
ââ 
.
ââ 
View
ââ 
(
ââ 
@event
ââ #
)
ââ# $
;
ââ$ %
}
ää 	
[
çç 	
HttpPost
çç	 
]
çç 
[
éé 	

ActionName
éé	 
(
éé 
$str
éé 
)
éé 
]
éé 
[
èè 	&
ValidateAntiForgeryToken
èè	 !
]
èè! "
public
êê 
async
êê 
Task
êê 
<
êê 
IActionResult
êê '
>
êê' (
DeleteConfirmed
êê) 8
(
êê8 9
int
êê9 <
id
êê= ?
)
êê? @
{
ëë 	
var
íí 
@event
íí 
=
íí 
await
íí 
this
íí #
.
íí# $
context
íí$ +
.
íí+ ,(
AllAsNoTrackingWithDeleted
íí, F
(
ííF G
)
ííG H
.
ííH I!
FirstOrDefaultAsync
ííI \
(
íí\ ]
x
íí] ^
=>
íí_ a
x
ííb c
.
ííc d
Id
ííd f
==
ííg i
id
ííj l
)
ííl m
;
íím n
this
ìì 
.
ìì 
context
ìì 
.
ìì 
Delete
ìì 
(
ìì  
@event
ìì  &
)
ìì& '
;
ìì' (
await
îî 
this
îî 
.
îî 
context
îî 
.
îî 
SaveChangesAsync
îî /
(
îî/ 0
)
îî0 1
;
îî1 2
return
ïï 
this
ïï 
.
ïï 
RedirectToAction
ïï (
(
ïï( )
nameof
ïï) /
(
ïï/ 0
this
ïï0 4
.
ïï4 5
Index
ïï5 :
)
ïï: ;
)
ïï; <
;
ïï< =
}
ññ 	
private
òò 
bool
òò 
EventExists
òò  
(
òò  !
int
òò! $
id
òò% '
)
òò' (
{
ôô 	
return
öö 
this
öö 
.
öö 
context
öö 
.
öö  (
AllAsNoTrackingWithDeleted
öö  :
(
öö: ;
)
öö; <
.
öö< =
Any
öö= @
(
öö@ A
e
ööA B
=>
ööC E
e
ööF G
.
ööG H
Id
ööH J
==
ööK M
id
ööN P
)
ööP Q
;
ööQ R
}
õõ 	
}
úú 
}ùù Ñp
ÉC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\NewsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
NewsController 
:  !$
AdministrationController" :
{ 
private 
readonly &
IDeletableEntityRepository 3
<3 4
News4 8
>8 9
context: A
;A B
private 
readonly &
IDeletableEntityRepository 3
<3 4
CategoryNews4 @
>@ A
categoryNewsDbB P
;P Q
public 
NewsController 
( &
IDeletableEntityRepository 8
<8 9
News9 =
>= >
context? F
,F G&
IDeletableEntityRepositoryH b
<b c
CategoryNewsc o
>o p
categoryNewsDbq 
)	 Ä
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 
categoryNewsDb 
=  !
categoryNewsDb" 0
;0 1
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
var  
applicationDbContext $
=% &
this' +
.+ ,
context, 3
.3 4
AllWithDeleted4 B
(B C
)C D
.D E
IncludeE L
(L M
nM N
=>O Q
nR S
.S T
CategoryT \
)\ ]
;] ^
return 
this 
. 
View 
( 
await " 
applicationDbContext# 7
.7 8
ToListAsync8 C
(C D
)D E
)E F
;F G
} 	
public   
async   
Task   
<   
IActionResult   '
>  ' (
Details  ) 0
(  0 1
int  1 4
?  4 5
id  6 8
)  8 9
{!! 	
if"" 
("" 
id"" 
=="" 
null"" 
)"" 
{## 
return$$ 
this$$ 
.$$ 
NotFound$$ $
($$$ %
)$$% &
;$$& '
}%% 
var'' 
news'' 
='' 
await'' 
this'' !
.''! "
context''" )
.'') *
AllWithDeleted''* 8
(''8 9
)''9 :
.(( 
Include(( 
((( 
n(( 
=>(( 
n(( 
.((  
Category((  (
)((( )
.)) 
FirstOrDefaultAsync)) $
())$ %
m))% &
=>))' )
m))* +
.))+ ,
Id)), .
==))/ 1
id))2 4
)))4 5
;))5 6
if** 
(** 
news** 
==** 
null** 
)** 
{++ 
return,, 
this,, 
.,, 
NotFound,, $
(,,$ %
),,% &
;,,& '
}-- 
return// 
this// 
.// 
View// 
(// 
news// !
)//! "
;//" #
}00 	
public33 
IActionResult33 
Create33 #
(33# $
)33$ %
{44 	
this55 
.55 
ViewData55 
[55 
$str55 &
]55& '
=55( )
new55* -

SelectList55. 8
(558 9
this559 =
.55= >
categoryNewsDb55> L
.55L M
AllWithDeleted55M [
(55[ \
)55\ ]
,55] ^
$str55_ c
,55c d
$str55e k
)55k l
;55l m
return66 
this66 
.66 
View66 
(66 
)66 
;66 
}77 	
[<< 	
HttpPost<<	 
]<< 
[== 	$
ValidateAntiForgeryToken==	 !
]==! "
public>> 
async>> 
Task>> 
<>> 
IActionResult>> '
>>>' (
Create>>) /
(>>/ 0
[>>0 1
Bind>>1 5
(>>5 6
$str	>>6 ª
)
>>ª º
]
>>º Ω
News
>>æ ¬
news
>>√ «
)
>>« »
{?? 	
if@@ 
(@@ 
this@@ 
.@@ 

ModelState@@ 
.@@  
IsValid@@  '
)@@' (
{AA 
awaitBB 
thisBB 
.BB 
contextBB "
.BB" #
AddAsyncBB# +
(BB+ ,
newsBB, 0
)BB0 1
;BB1 2
awaitCC 
thisCC 
.CC 
contextCC "
.CC" #
SaveChangesAsyncCC# 3
(CC3 4
)CC4 5
;CC5 6
returnDD 
thisDD 
.DD 
RedirectToActionDD ,
(DD, -
nameofDD- 3
(DD3 4
thisDD4 8
.DD8 9
IndexDD9 >
)DD> ?
)DD? @
;DD@ A
}EE 
thisGG 
.GG 
ViewDataGG 
[GG 
$strGG &
]GG& '
=GG( )
newGG* -

SelectListGG. 8
(GG8 9
thisGG9 =
.GG= >
categoryNewsDbGG> L
.GGL M
AllWithDeletedGGM [
(GG[ \
)GG\ ]
,GG] ^
$strGG_ c
,GGc d
$strGGe k
,GGk l
newsGGm q
.GGq r

CategoryIdGGr |
)GG| }
;GG} ~
returnHH 
thisHH 
.HH 
ViewHH 
(HH 
newsHH !
)HH! "
;HH" #
}II 	
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
EditLL) -
(LL- .
intLL. 1
?LL1 2
idLL3 5
)LL5 6
{MM 	
ifNN 
(NN 
idNN 
==NN 
nullNN 
)NN 
{OO 
returnPP 
thisPP 
.PP 
NotFoundPP $
(PP$ %
)PP% &
;PP& '
}QQ 
varSS 
newsSS 
=SS 
awaitSS 
thisSS !
.SS! "
contextSS" )
.SS) *
AllWithDeletedSS* 8
(SS8 9
)SS9 :
.SS: ;
FirstOrDefaultAsyncSS; N
(SSN O
xSSO P
=>SSQ S
xSST U
.SSU V
IdSSV X
==SSY [
idSS\ ^
)SS^ _
;SS_ `
ifTT 
(TT 
newsTT 
==TT 
nullTT 
)TT 
{UU 
returnVV 
thisVV 
.VV 
NotFoundVV $
(VV$ %
)VV% &
;VV& '
}WW 
thisYY 
.YY 
ViewDataYY 
[YY 
$strYY &
]YY& '
=YY( )
newYY* -

SelectListYY. 8
(YY8 9
thisYY9 =
.YY= >
categoryNewsDbYY> L
.YYL M
AllWithDeletedYYM [
(YY[ \
)YY\ ]
,YY] ^
$strYY_ c
,YYc d
$strYYe k
,YYk l
newsYYm q
.YYq r

CategoryIdYYr |
)YY| }
;YY} ~
returnZZ 
thisZZ 
.ZZ 
ViewZZ 
(ZZ 
newsZZ !
)ZZ! "
;ZZ" #
}[[ 	
[`` 	
HttpPost``	 
]`` 
[aa 	$
ValidateAntiForgeryTokenaa	 !
]aa! "
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
Editbb) -
(bb- .
intbb. 1
idbb2 4
,bb4 5
[bb6 7
Bindbb7 ;
(bb; <
$str	bb< ¡
)
bb¡ ¬
]
bb¬ √
News
bbƒ »
news
bb… Õ
)
bbÕ Œ
{cc 	
ifdd 
(dd 
iddd 
!=dd 
newsdd 
.dd 
Iddd 
)dd 
{ee 
returnff 
thisff 
.ff 
NotFoundff $
(ff$ %
)ff% &
;ff& '
}gg 
ifii 
(ii 
thisii 
.ii 

ModelStateii 
.ii  
IsValidii  '
)ii' (
{jj 
trykk 
{ll 
thismm 
.mm 
contextmm  
.mm  !
Updatemm! '
(mm' (
newsmm( ,
)mm, -
;mm- .
awaitnn 
thisnn 
.nn 
contextnn &
.nn& '
SaveChangesAsyncnn' 7
(nn7 8
)nn8 9
;nn9 :
}oo 
catchpp 
(pp (
DbUpdateConcurrencyExceptionpp 3
)pp3 4
{qq 
ifrr 
(rr 
!rr 
thisrr 
.rr 

NewsExistsrr (
(rr( )
newsrr) -
.rr- .
Idrr. 0
)rr0 1
)rr1 2
{ss 
returntt 
thistt #
.tt# $
NotFoundtt$ ,
(tt, -
)tt- .
;tt. /
}uu 
elsevv 
{ww 
throwxx 
;xx 
}yy 
}zz 
return|| 
this|| 
.|| 
RedirectToAction|| ,
(||, -
nameof||- 3
(||3 4
this||4 8
.||8 9
Index||9 >
)||> ?
)||? @
;||@ A
}}} 
this 
. 
ViewData 
[ 
$str &
]& '
=( )
new* -

SelectList. 8
(8 9
this9 =
.= >
categoryNewsDb> L
.L M
AllWithDeletedM [
([ \
)\ ]
,] ^
$str_ c
,c d
$stre k
,k l
newsm q
.q r

CategoryIdr |
)| }
;} ~
return
ÄÄ 
this
ÄÄ 
.
ÄÄ 
View
ÄÄ 
(
ÄÄ 
news
ÄÄ !
)
ÄÄ! "
;
ÄÄ" #
}
ÅÅ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
Delete
ÑÑ) /
(
ÑÑ/ 0
int
ÑÑ0 3
?
ÑÑ3 4
id
ÑÑ5 7
)
ÑÑ7 8
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
id
ÜÜ 
==
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
this
àà 
.
àà 
NotFound
àà $
(
àà$ %
)
àà% &
;
àà& '
}
ââ 
var
ãã 
news
ãã 
=
ãã 
await
ãã 
this
ãã !
.
ãã! "
context
ãã" )
.
ãã) *
AllWithDeleted
ãã* 8
(
ãã8 9
)
ãã9 :
.
åå 
Include
åå 
(
åå 
n
åå 
=>
åå 
n
åå 
.
åå  
Category
åå  (
)
åå( )
.
çç !
FirstOrDefaultAsync
çç $
(
çç$ %
m
çç% &
=>
çç' )
m
çç* +
.
çç+ ,
Id
çç, .
==
çç/ 1
id
çç2 4
)
çç4 5
;
çç5 6
if
éé 
(
éé 
news
éé 
==
éé 
null
éé 
)
éé 
{
èè 
return
êê 
this
êê 
.
êê 
NotFound
êê $
(
êê$ %
)
êê% &
;
êê& '
}
ëë 
return
ìì 
this
ìì 
.
ìì 
View
ìì 
(
ìì 
news
ìì !
)
ìì! "
;
ìì" #
}
îî 	
[
óó 	
HttpPost
óó	 
]
óó 
[
òò 	

ActionName
òò	 
(
òò 
$str
òò 
)
òò 
]
òò 
[
ôô 	&
ValidateAntiForgeryToken
ôô	 !
]
ôô! "
public
öö 
async
öö 
Task
öö 
<
öö 
IActionResult
öö '
>
öö' (
DeleteConfirmed
öö) 8
(
öö8 9
int
öö9 <
id
öö= ?
)
öö? @
{
õõ 	
var
úú 
news
úú 
=
úú 
await
úú 
this
úú !
.
úú! "
context
úú" )
.
úú) *
AllWithDeleted
úú* 8
(
úú8 9
)
úú9 :
.
úú: ;!
FirstOrDefaultAsync
úú; N
(
úúN O
x
úúO P
=>
úúQ S
x
úúT U
.
úúU V
Id
úúV X
==
úúY [
id
úú\ ^
)
úú^ _
;
úú_ `
this
ùù 
.
ùù 
context
ùù 
.
ùù 
Delete
ùù 
(
ùù  
news
ùù  $
)
ùù$ %
;
ùù% &
await
ûû 
this
ûû 
.
ûû 
context
ûû 
.
ûû 
SaveChangesAsync
ûû /
(
ûû/ 0
)
ûû0 1
;
ûû1 2
return
üü 
this
üü 
.
üü 
RedirectToAction
üü (
(
üü( )
nameof
üü) /
(
üü/ 0
this
üü0 4
.
üü4 5
Index
üü5 :
)
üü: ;
)
üü; <
;
üü< =
}
†† 	
private
¢¢ 
bool
¢¢ 

NewsExists
¢¢ 
(
¢¢  
int
¢¢  #
id
¢¢$ &
)
¢¢& '
{
££ 	
return
§§ 
this
§§ 
.
§§ 
context
§§ 
.
§§  
AllWithDeleted
§§  .
(
§§. /
)
§§/ 0
.
§§0 1
Any
§§1 4
(
§§4 5
e
§§5 6
=>
§§7 9
e
§§: ;
.
§§; <
Id
§§< >
==
§§? A
id
§§B D
)
§§D E
;
§§E F
}
•• 	
}
¶¶ 
}ßß √o
ÑC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\PostsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
PostsController  
:! "$
AdministrationController# ;
{ 
private 
readonly &
IDeletableEntityRepository 3
<3 4
Post4 8
>8 9
context: A
;A B
private 
readonly &
IDeletableEntityRepository 3
<3 4
ApplicationUser4 C
>C D
userDbE K
;K L
public 
PostsController 
( &
IDeletableEntityRepository 9
<9 :
Post: >
>> ?
context@ G
,G H&
IDeletableEntityRepositoryI c
<c d
ApplicationUserd s
>s t
userDbu {
){ |
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 
userDb 
= 
userDb  
;  !
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
var  
applicationDbContext $
=% &
this' +
.+ ,
context, 3
.3 4
AllWithDeleted4 B
(B C
)C D
.D E
IncludeE L
(L M
pM N
=>O Q
pR S
.S T
UserT X
)X Y
;Y Z
return 
this 
. 
View 
( 
await " 
applicationDbContext# 7
.7 8
ToListAsync8 C
(C D
)D E
)E F
;F G
} 	
public   
async   
Task   
<   
IActionResult   '
>  ' (
Details  ) 0
(  0 1
int  1 4
?  4 5
id  6 8
)  8 9
{!! 	
if"" 
("" 
id"" 
=="" 
null"" 
)"" 
{## 
return$$ 
this$$ 
.$$ 
NotFound$$ $
($$$ %
)$$% &
;$$& '
}%% 
var'' 
post'' 
='' 
await'' 
this'' !
.''! "
context''" )
.'') *
AllWithDeleted''* 8
(''8 9
)''9 :
.(( 
Include(( 
((( 
p(( 
=>(( 
p(( 
.((  
User((  $
)(($ %
.)) 
FirstOrDefaultAsync)) $
())$ %
m))% &
=>))' )
m))* +
.))+ ,
Id)), .
==))/ 1
id))2 4
)))4 5
;))5 6
if** 
(** 
post** 
==** 
null** 
)** 
{++ 
return,, 
this,, 
.,, 
NotFound,, $
(,,$ %
),,% &
;,,& '
}-- 
return// 
this// 
.// 
View// 
(// 
post// !
)//! "
;//" #
}00 	
public33 
IActionResult33 
Create33 #
(33# $
)33$ %
{44 	
this55 
.55 
ViewData55 
[55 
$str55 '
]55' (
=55) *
new55+ .

SelectList55/ 9
(559 :
this55: >
.55> ?
userDb55? E
.55E F
AllWithDeleted55F T
(55T U
)55U V
,55V W
$str55X \
,55\ ]
$str55^ b
)55b c
;55c d
return66 
this66 
.66 
View66 
(66 
)66 
;66 
}77 	
[<< 	
HttpPost<<	 
]<< 
[== 	$
ValidateAntiForgeryToken==	 !
]==! "
public>> 
async>> 
Task>> 
<>> 
IActionResult>> '
>>>' (
Create>>) /
(>>/ 0
[>>0 1
Bind>>1 5
(>>5 6
$str	>>6 ë
)
>>ë í
]
>>í ì
Post
>>î ò
post
>>ô ù
)
>>ù û
{?? 	
if@@ 
(@@ 
this@@ 
.@@ 

ModelState@@ 
.@@  
IsValid@@  '
)@@' (
{AA 
awaitBB 
thisBB 
.BB 
contextBB "
.BB" #
AddAsyncBB# +
(BB+ ,
postBB, 0
)BB0 1
;BB1 2
awaitCC 
thisCC 
.CC 
contextCC "
.CC" #
SaveChangesAsyncCC# 3
(CC3 4
)CC4 5
;CC5 6
returnDD 
thisDD 
.DD 
RedirectToActionDD ,
(DD, -
nameofDD- 3
(DD3 4
thisDD4 8
.DD8 9
IndexDD9 >
)DD> ?
)DD? @
;DD@ A
}EE 
thisGG 
.GG 
ViewDataGG 
[GG 
$strGG '
]GG' (
=GG) *
newGG+ .

SelectListGG/ 9
(GG9 :
thisGG: >
.GG> ?
userDbGG? E
.GGE F
AllWithDeletedGGF T
(GGT U
)GGU V
,GGV W
$strGGX \
,GG\ ]
$strGG^ b
,GGb c
postGGd h
.GGh i
CreatedByIdGGi t
)GGt u
;GGu v
returnHH 
thisHH 
.HH 
ViewHH 
(HH 
postHH !
)HH! "
;HH" #
}II 	
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
EditLL) -
(LL- .
intLL. 1
?LL1 2
idLL3 5
)LL5 6
{MM 	
ifNN 
(NN 
idNN 
==NN 
nullNN 
)NN 
{OO 
returnPP 
thisPP 
.PP 
NotFoundPP $
(PP$ %
)PP% &
;PP& '
}QQ 
varSS 
postSS 
=SS 
awaitSS 
thisSS !
.SS! "
contextSS" )
.SS) *
AllWithDeletedSS* 8
(SS8 9
)SS9 :
.SS: ;
FirstOrDefaultAsyncSS; N
(SSN O
xSSO P
=>SSQ S
xSST U
.SSU V
IdSSV X
==SSY [
idSS\ ^
)SS^ _
;SS_ `
ifTT 
(TT 
postTT 
==TT 
nullTT 
)TT 
{UU 
returnVV 
thisVV 
.VV 
NotFoundVV $
(VV$ %
)VV% &
;VV& '
}WW 
thisYY 
.YY 
ViewDataYY 
[YY 
$strYY '
]YY' (
=YY) *
newYY+ .

SelectListYY/ 9
(YY9 :
thisYY: >
.YY> ?
userDbYY? E
.YYE F
AllWithDeletedYYF T
(YYT U
)YYU V
,YYV W
$strYYX \
,YY\ ]
$strYY^ b
,YYb c
postYYd h
.YYh i
CreatedByIdYYi t
)YYt u
;YYu v
returnZZ 
thisZZ 
.ZZ 
ViewZZ 
(ZZ 
postZZ !
)ZZ! "
;ZZ" #
}[[ 	
[`` 	
HttpPost``	 
]`` 
[aa 	$
ValidateAntiForgeryTokenaa	 !
]aa! "
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
Editbb) -
(bb- .
intbb. 1
idbb2 4
,bb4 5
[bb6 7
Bindbb7 ;
(bb; <
$str	bb< ó
)
bbó ò
]
bbò ô
Post
bbö û
post
bbü £
)
bb£ §
{cc 	
ifdd 
(dd 
iddd 
!=dd 
postdd 
.dd 
Iddd 
)dd 
{ee 
returnff 
thisff 
.ff 
NotFoundff $
(ff$ %
)ff% &
;ff& '
}gg 
ifii 
(ii 
thisii 
.ii 

ModelStateii 
.ii  
IsValidii  '
)ii' (
{jj 
trykk 
{ll 
thismm 
.mm 
contextmm  
.mm  !
Updatemm! '
(mm' (
postmm( ,
)mm, -
;mm- .
awaitnn 
thisnn 
.nn 
contextnn &
.nn& '
SaveChangesAsyncnn' 7
(nn7 8
)nn8 9
;nn9 :
}oo 
catchpp 
(pp (
DbUpdateConcurrencyExceptionpp 3
)pp3 4
{qq 
ifrr 
(rr 
!rr 
thisrr 
.rr 

PostExistsrr (
(rr( )
postrr) -
.rr- .
Idrr. 0
)rr0 1
)rr1 2
{ss 
returntt 
thistt #
.tt# $
NotFoundtt$ ,
(tt, -
)tt- .
;tt. /
}uu 
elsevv 
{ww 
throwxx 
;xx 
}yy 
}zz 
return|| 
this|| 
.|| 
RedirectToAction|| ,
(||, -
nameof||- 3
(||3 4
this||4 8
.||8 9
Index||9 >
)||> ?
)||? @
;||@ A
}}} 
this 
. 
ViewData 
[ 
$str '
]' (
=) *
new+ .

SelectList/ 9
(9 :
this: >
.> ?
userDb? E
.E F
AllWithDeletedF T
(T U
)U V
,V W
$strX \
,\ ]
$str^ b
,b c
postd h
.h i
CreatedByIdi t
)t u
;u v
return
ÅÅ 
this
ÅÅ 
.
ÅÅ 
View
ÅÅ 
(
ÅÅ 
post
ÅÅ !
)
ÅÅ! "
;
ÅÅ" #
}
ÇÇ 	
public
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
IActionResult
ÖÖ '
>
ÖÖ' (
Delete
ÖÖ) /
(
ÖÖ/ 0
int
ÖÖ0 3
?
ÖÖ3 4
id
ÖÖ5 7
)
ÖÖ7 8
{
ÜÜ 	
if
áá 
(
áá 
id
áá 
==
áá 
null
áá 
)
áá 
{
àà 
return
ââ 
this
ââ 
.
ââ 
NotFound
ââ $
(
ââ$ %
)
ââ% &
;
ââ& '
}
ää 
var
åå 
post
åå 
=
åå 
await
åå 
this
åå !
.
åå! "
context
åå" )
.
åå) *
AllWithDeleted
åå* 8
(
åå8 9
)
åå9 :
.
çç 
Include
çç 
(
çç 
p
çç 
=>
çç 
p
çç 
.
çç  
User
çç  $
)
çç$ %
.
éé !
FirstOrDefaultAsync
éé $
(
éé$ %
m
éé% &
=>
éé' )
m
éé* +
.
éé+ ,
Id
éé, .
==
éé/ 1
id
éé2 4
)
éé4 5
;
éé5 6
if
èè 
(
èè 
post
èè 
==
èè 
null
èè 
)
èè 
{
êê 
return
ëë 
this
ëë 
.
ëë 
NotFound
ëë $
(
ëë$ %
)
ëë% &
;
ëë& '
}
íí 
return
îî 
this
îî 
.
îî 
View
îî 
(
îî 
post
îî !
)
îî! "
;
îî" #
}
ïï 	
[
òò 	
HttpPost
òò	 
]
òò 
[
ôô 	

ActionName
ôô	 
(
ôô 
$str
ôô 
)
ôô 
]
ôô 
[
öö 	&
ValidateAntiForgeryToken
öö	 !
]
öö! "
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (
DeleteConfirmed
õõ) 8
(
õõ8 9
int
õõ9 <
id
õõ= ?
)
õõ? @
{
úú 	
var
ùù 
post
ùù 
=
ùù 
await
ùù 
this
ùù !
.
ùù! "
context
ùù" )
.
ùù) *
AllWithDeleted
ùù* 8
(
ùù8 9
)
ùù9 :
.
ùù: ;!
FirstOrDefaultAsync
ùù; N
(
ùùN O
x
ùùO P
=>
ùùQ S
x
ùùT U
.
ùùU V
Id
ùùV X
==
ùùY [
id
ùù\ ^
)
ùù^ _
;
ùù_ `
this
ûû 
.
ûû 
context
ûû 
.
ûû 
Delete
ûû 
(
ûû  
post
ûû  $
)
ûû$ %
;
ûû% &
await
üü 
this
üü 
.
üü 
context
üü 
.
üü 
SaveChangesAsync
üü /
(
üü/ 0
)
üü0 1
;
üü1 2
return
†† 
this
†† 
.
†† 
RedirectToAction
†† (
(
††( )
nameof
††) /
(
††/ 0
this
††0 4
.
††4 5
Index
††5 :
)
††: ;
)
††; <
;
††< =
}
°° 	
private
££ 
bool
££ 

PostExists
££ 
(
££  
int
££  #
id
££$ &
)
££& '
{
§§ 	
return
•• 
this
•• 
.
•• 
context
•• 
.
••  
AllWithDeleted
••  .
(
••. /
)
••/ 0
.
••0 1
Any
••1 4
(
••4 5
e
••5 6
=>
••7 9
e
••: ;
.
••; <
Id
••< >
==
••? A
id
••B D
)
••D E
;
••E F
}
¶¶ 	
}
ßß 
}®® ¬p
àC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Areas\Administration\Controllers\ProposalsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Areas 
. 
Administration +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
ProposalsController $
:% &$
AdministrationController' ?
{ 
private 
readonly &
IDeletableEntityRepository 3
<3 4
Proposal4 <
>< =
context> E
;E F
private 
readonly &
IDeletableEntityRepository 3
<3 4
ApplicationUser4 C
>C D
userDbE K
;K L
public 
ProposalsController "
(" #&
IDeletableEntityRepository# =
<= >
Proposal> F
>F G
contextH O
,O P&
IDeletableEntityRepositoryQ k
<k l
ApplicationUserl {
>{ |
userDb	} É
)
É Ñ
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 
userDb 
= 
userDb  
;  !
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
var  
applicationDbContext $
=% &
this' +
.+ ,
context, 3
.3 4
AllWithDeleted4 B
(B C
)C D
.D E
IncludeE L
(L M
pM N
=>O Q
pR S
.S T
UserT X
)X Y
;Y Z
return 
this 
. 
View 
( 
await " 
applicationDbContext# 7
.7 8
ToListAsync8 C
(C D
)D E
)E F
;F G
} 	
public   
async   
Task   
<   
IActionResult   '
>  ' (
Details  ) 0
(  0 1
int  1 4
?  4 5
id  6 8
)  8 9
{!! 	
if"" 
("" 
id"" 
=="" 
null"" 
)"" 
{## 
return$$ 
this$$ 
.$$ 
NotFound$$ $
($$$ %
)$$% &
;$$& '
}%% 
var'' 
proposal'' 
='' 
await''  
this''! %
.''% &
context''& -
.''- .
AllWithDeleted''. <
(''< =
)''= >
.(( 
Include(( 
((( 
p(( 
=>(( 
p(( 
.((  
User((  $
)(($ %
.)) 
FirstOrDefaultAsync)) $
())$ %
m))% &
=>))' )
m))* +
.))+ ,
Id)), .
==))/ 1
id))2 4
)))4 5
;))5 6
if** 
(** 
proposal** 
==** 
null**  
)**  !
{++ 
return,, 
this,, 
.,, 
NotFound,, $
(,,$ %
),,% &
;,,& '
}-- 
return// 
this// 
.// 
View// 
(// 
proposal// %
)//% &
;//& '
}00 	
public33 
IActionResult33 
Create33 #
(33# $
)33$ %
{44 	
this55 
.55 
ViewData55 
[55 
$str55 '
]55' (
=55) *
new55+ .

SelectList55/ 9
(559 :
this55: >
.55> ?
userDb55? E
.55E F
AllWithDeleted55F T
(55T U
)55U V
,55V W
$str55X \
,55\ ]
$str55^ b
)55b c
;55c d
return66 
this66 
.66 
View66 
(66 
)66 
;66 
}77 	
[<< 	
HttpPost<<	 
]<< 
[== 	$
ValidateAntiForgeryToken==	 !
]==! "
public>> 
async>> 
Task>> 
<>> 
IActionResult>> '
>>>' (
Create>>) /
(>>/ 0
[>>0 1
Bind>>1 5
(>>5 6
$str	>>6 í
)
>>í ì
]
>>ì î
Proposal
>>ï ù
proposal
>>û ¶
)
>>¶ ß
{?? 	
if@@ 
(@@ 
this@@ 
.@@ 

ModelState@@ 
.@@  
IsValid@@  '
)@@' (
{AA 
awaitBB 
thisBB 
.BB 
contextBB "
.BB" #
AddAsyncBB# +
(BB+ ,
proposalBB, 4
)BB4 5
;BB5 6
awaitCC 
thisCC 
.CC 
contextCC "
.CC" #
SaveChangesAsyncCC# 3
(CC3 4
)CC4 5
;CC5 6
returnDD 
thisDD 
.DD 
RedirectToActionDD ,
(DD, -
nameofDD- 3
(DD3 4
thisDD4 8
.DD8 9
IndexDD9 >
)DD> ?
)DD? @
;DD@ A
}EE 
thisGG 
.GG 
ViewDataGG 
[GG 
$strGG '
]GG' (
=GG) *
newGG+ .

SelectListGG/ 9
(GG9 :
thisGG: >
.GG> ?
userDbGG? E
.GGE F
AllWithDeletedGGF T
(GGT U
)GGU V
,GGV W
$strGGX \
,GG\ ]
$strGG^ b
,GGb c
proposalGGd l
.GGl m
CreatedByIdGGm x
)GGx y
;GGy z
returnHH 
thisHH 
.HH 
ViewHH 
(HH 
proposalHH %
)HH% &
;HH& '
}II 	
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
EditLL) -
(LL- .
intLL. 1
?LL1 2
idLL3 5
)LL5 6
{MM 	
ifNN 
(NN 
idNN 
==NN 
nullNN 
)NN 
{OO 
returnPP 
thisPP 
.PP 
NotFoundPP $
(PP$ %
)PP% &
;PP& '
}QQ 
varSS 
proposalSS 
=SS 
awaitSS  
thisSS! %
.SS% &
contextSS& -
.SS- .
AllWithDeletedSS. <
(SS< =
)SS= >
.SS> ?
FirstOrDefaultAsyncSS? R
(SSR S
xSSS T
=>SSU W
xSSX Y
.SSY Z
IdSSZ \
==SS] _
idSS` b
)SSb c
;SSc d
ifTT 
(TT 
proposalTT 
==TT 
nullTT  
)TT  !
{UU 
returnVV 
thisVV 
.VV 
NotFoundVV $
(VV$ %
)VV% &
;VV& '
}WW 
thisYY 
.YY 
ViewDataYY 
[YY 
$strYY '
]YY' (
=YY) *
newYY+ .

SelectListYY/ 9
(YY9 :
thisYY: >
.YY> ?
userDbYY? E
.YYE F
AllWithDeletedYYF T
(YYT U
)YYU V
,YYV W
$strYYX \
,YY\ ]
$strYY^ b
,YYb c
proposalYYd l
.YYl m
CreatedByIdYYm x
)YYx y
;YYy z
returnZZ 
thisZZ 
.ZZ 
ViewZZ 
(ZZ 
proposalZZ %
)ZZ% &
;ZZ& '
}[[ 	
[`` 	
HttpPost``	 
]`` 
[aa 	$
ValidateAntiForgeryTokenaa	 !
]aa! "
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
Editbb) -
(bb- .
intbb. 1
idbb2 4
,bb4 5
[bb6 7
Bindbb7 ;
(bb; <
$str	bb< ò
)
bbò ô
]
bbô ö
Proposal
bbõ £
proposal
bb§ ¨
)
bb¨ ≠
{cc 	
ifdd 
(dd 
iddd 
!=dd 
proposaldd 
.dd 
Iddd !
)dd! "
{ee 
returnff 
thisff 
.ff 
NotFoundff $
(ff$ %
)ff% &
;ff& '
}gg 
ifii 
(ii 
thisii 
.ii 

ModelStateii 
.ii  
IsValidii  '
)ii' (
{jj 
trykk 
{ll 
thismm 
.mm 
contextmm  
.mm  !
Updatemm! '
(mm' (
proposalmm( 0
)mm0 1
;mm1 2
awaitnn 
thisnn 
.nn 
contextnn &
.nn& '
SaveChangesAsyncnn' 7
(nn7 8
)nn8 9
;nn9 :
}oo 
catchpp 
(pp (
DbUpdateConcurrencyExceptionpp 3
)pp3 4
{qq 
ifrr 
(rr 
!rr 
thisrr 
.rr 
ProposalExistsrr ,
(rr, -
proposalrr- 5
.rr5 6
Idrr6 8
)rr8 9
)rr9 :
{ss 
returntt 
thistt #
.tt# $
NotFoundtt$ ,
(tt, -
)tt- .
;tt. /
}uu 
elsevv 
{ww 
throwxx 
;xx 
}yy 
}zz 
return|| 
this|| 
.|| 
RedirectToAction|| ,
(||, -
nameof||- 3
(||3 4
this||4 8
.||8 9
Index||9 >
)||> ?
)||? @
;||@ A
}}} 
this 
. 
ViewData 
[ 
$str '
]' (
=) *
new+ .

SelectList/ 9
(9 :
this: >
.> ?
userDb? E
.E F
AllWithDeletedF T
(T U
)U V
,V W
$strX \
,\ ]
$str^ b
,b c
proposald l
.l m
CreatedByIdm x
)x y
;y z
return
ÄÄ 
this
ÄÄ 
.
ÄÄ 
View
ÄÄ 
(
ÄÄ 
proposal
ÄÄ %
)
ÄÄ% &
;
ÄÄ& '
}
ÅÅ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
Delete
ÑÑ) /
(
ÑÑ/ 0
int
ÑÑ0 3
?
ÑÑ3 4
id
ÑÑ5 7
)
ÑÑ7 8
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
id
ÜÜ 
==
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
this
àà 
.
àà 
NotFound
àà $
(
àà$ %
)
àà% &
;
àà& '
}
ââ 
var
ãã 
proposal
ãã 
=
ãã 
await
ãã  
this
ãã! %
.
ãã% &
context
ãã& -
.
ãã- .
AllWithDeleted
ãã. <
(
ãã< =
)
ãã= >
.
åå 
Include
åå 
(
åå 
p
åå 
=>
åå 
p
åå 
.
åå  
User
åå  $
)
åå$ %
.
çç !
FirstOrDefaultAsync
çç $
(
çç$ %
m
çç% &
=>
çç' )
m
çç* +
.
çç+ ,
Id
çç, .
==
çç/ 1
id
çç2 4
)
çç4 5
;
çç5 6
if
éé 
(
éé 
proposal
éé 
==
éé 
null
éé  
)
éé  !
{
èè 
return
êê 
this
êê 
.
êê 
NotFound
êê $
(
êê$ %
)
êê% &
;
êê& '
}
ëë 
return
ìì 
this
ìì 
.
ìì 
View
ìì 
(
ìì 
proposal
ìì %
)
ìì% &
;
ìì& '
}
îî 	
[
óó 	
HttpPost
óó	 
]
óó 
[
òò 	

ActionName
òò	 
(
òò 
$str
òò 
)
òò 
]
òò 
[
ôô 	&
ValidateAntiForgeryToken
ôô	 !
]
ôô! "
public
öö 
async
öö 
Task
öö 
<
öö 
IActionResult
öö '
>
öö' (
DeleteConfirmed
öö) 8
(
öö8 9
int
öö9 <
id
öö= ?
)
öö? @
{
õõ 	
var
úú 
proposal
úú 
=
úú 
await
úú  
this
úú! %
.
úú% &
context
úú& -
.
úú- .
AllWithDeleted
úú. <
(
úú< =
)
úú= >
.
úú> ?!
FirstOrDefaultAsync
úú? R
(
úúR S
x
úúS T
=>
úúU W
x
úúX Y
.
úúY Z
Id
úúZ \
==
úú] _
id
úú` b
)
úúb c
;
úúc d
this
ùù 
.
ùù 
context
ùù 
.
ùù 
Delete
ùù 
(
ùù  
proposal
ùù  (
)
ùù( )
;
ùù) *
await
ûû 
this
ûû 
.
ûû 
context
ûû 
.
ûû 
SaveChangesAsync
ûû /
(
ûû/ 0
)
ûû0 1
;
ûû1 2
return
üü 
this
üü 
.
üü 
RedirectToAction
üü (
(
üü( )
nameof
üü) /
(
üü/ 0
this
üü0 4
.
üü4 5
Index
üü5 :
)
üü: ;
)
üü; <
;
üü< =
}
†† 	
private
¢¢ 
bool
¢¢ 
ProposalExists
¢¢ #
(
¢¢# $
int
¢¢$ '
id
¢¢( *
)
¢¢* +
{
££ 	
return
§§ 
this
§§ 
.
§§ 
context
§§ 
.
§§  
AllWithDeleted
§§  .
(
§§. /
)
§§/ 0
.
§§0 1
Any
§§1 4
(
§§4 5
e
§§5 6
=>
§§7 9
e
§§: ;
.
§§; <
Id
§§< >
==
§§? A
id
§§B D
)
§§D E
;
§§E F
}
•• 	
}
¶¶ 
}ßß Ö
nC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\BaseController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
BaseController 
:  !

Controller" ,
{ 
} 
} ˝
oC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\ChartController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
ChartController  
:! "
BaseController# 1
{ 
private 
readonly 
IChartService &
charService' 2
;2 3
public 
ChartController 
( 
IChartService ,
charService- 8
)8 9
{ 	
this 
. 
charService 
= 
charService *
;* +
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
ChartResponseModel' 9
>9 :
>: ;
GetActivity< G
(G H
)H I
{ 	
var 
montlyActivity 
=  
await! &
this' +
.+ ,
charService, 7
.7 8
GetMonthsActivity8 I
(I J
)J K
;K L
var !
monthlyActivirtyModel %
=& '
new( +
ChartResponseModel, >
{ 
MonthsActivity 
=  
montlyActivity! /
,/ 0
} 
; 
return !
monthlyActivirtyModel (
;( )
} 	
}   
}!! Ö#
rC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\CommentsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
CommentsController #
:$ %

Controller& 0
{ 
private 
readonly 
ICommentsService )
commentsService* 9
;9 :
public 
CommentsController !
(! "
ICommentsService" 2
commentsService3 B
)B C
{ 	
this 
. 
commentsService  
=! "
commentsService# 2
;2 3
} 	
[ 	
HttpPost	 
] 
[ 	
	Authorize	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Create) /
(/ 0
CommentInputModel0 A
modelB G
)G H
{ 	
if 
( 
! 
this 
. 

ModelState  
.  !
IsValid! (
)( )
{ 
return 
this 
. 
View  
(  !
)! "
;" #
} 
var 
parentId 
= 
model  
.  !
ParentId! )
==* ,
$num- .
?/ 0
(1 2
int2 5
?5 6
)6 7
null7 ;
:< =
model> C
.C D
ParentIdD L
;L M
if 
( 
parentId 
. 
HasValue !
)! "
{   
if!! 
(!! 
!!! 
this!! 
.!! 
commentsService!! )
.!!) *

IsInPostId!!* 4
(!!4 5
parentId!!5 =
.!!= >
Value!!> C
,!!C D
model!!E J
.!!J K
PostId!!K Q
)!!Q R
)!!R S
{"" 
return## 
this## 
.##  

BadRequest##  *
(##* +
)##+ ,
;##, -
}$$ 
}%% 
var'' 
userId'' 
='' 
this'' 
.'' 
User'' "
.''" #
FindFirstValue''# 1
(''1 2

ClaimTypes''2 <
.''< =
NameIdentifier''= K
)''K L
;''L M
await(( 
this(( 
.(( 
commentsService(( &
.((& '
CreateAsync((' 2
(((2 3
model((3 8
.((8 9
PostId((9 ?
,((? @
userId((A G
,((G H
model((I N
.((N O
Content((O V
,((V W
parentId((X `
)((` a
;((a b
return** 
this** 
.** 
RedirectToAction** (
(**( )
$str**) 2
,**2 3
$str**4 ;
,**; <
new**= @
{**A B
id**C E
=**F G
model**H M
.**M N
PostId**N T
}**U V
)**V W
;**W X
}++ 	
[-- 	
	Authorize--	 
]-- 
[.. 	
HttpPost..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
Delete//) /
(/// 0
int//0 3
id//4 6
)//6 7
{00 	
var11 
userId11 
=11 
this11 
.11 
User11 "
.11" #
FindFirstValue11# 1
(111 2

ClaimTypes112 <
.11< =
NameIdentifier11= K
)11K L
;11L M
var33 
postId33 
=33 
await33 
this33 #
.33# $
commentsService33$ 3
.333 4
DeleteByIdAsync334 C
(33C D
id33D F
,33F G
userId33H N
)33N O
;33O P
return55 
this55 
.55 
RedirectToAction55 (
(55( )
$str55) 2
,552 3
$str554 ;
,55; <
new55= @
{55A B
id55C E
=55F G
postId55H N
}55O P
)55P Q
;55Q R
}66 	
}77 
}88 ™J
pC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\EventsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
EventsController !
:" #
BaseController$ 2
{ 
private 
readonly 
IEventService &
eventService' 3
;3 4
public 
EventsController 
(  
IEventService  -
eventService. :
): ;
{ 	
this 
. 
eventService 
= 
eventService  ,
;, -
} 	
public 
IActionResult 
All  
(  !
int! $
id% '
=( )
$num* +
)+ ,
{ 	
if 
( 
id 
<= 
$num 
) 
{ 
return 
this 
. 
NotFound $
($ %
)% &
;& '
} 
const 
int 
ItemsPerPage "
=# $
$num% &
;& '
var 
	viewModel 
= 
new %
EventsListOutputViewModel  9
{   
ItemsPerPage!! 
=!! 
ItemsPerPage!! +
,!!+ ,

PageNumber"" 
="" 
id"" 
,""  
EntitiesCount## 
=## 
this##  $
.##$ %
eventService##% 1
.##1 2
GetCount##2 :
(##: ;
)##; <
,##< =
Events$$ 
=$$ 
this$$ 
.$$ 
eventService$$ *
.$$* +
GetAll$$+ 1
<$$1 2 
EventOutputViewModel$$2 F
>$$F G
($$G H
id$$H J
,$$J K
ItemsPerPage$$L X
)$$X Y
,$$Y Z
	AspAction%% 
=%% 
nameof%% "
(%%" #
this%%# '
.%%' (
All%%( +
)%%+ ,
,%%, -
}&& 
;&& 
return(( 
this(( 
.(( 
View(( 
((( 
	viewModel(( &
)((& '
;((' (
})) 	
[++ 	
	Authorize++	 
]++ 
public,, 
async,, 
Task,, 
<,, 
IActionResult,, '
>,,' (
Edit,,) -
(,,- .
int,,. 1
id,,2 4
),,4 5
{-- 	
var.. 

inputModel.. 
=.. 
await.. "
this..# '
...' (
eventService..( 4
...4 5
GetByIdAsync..5 A
<..A B
EventEditViewModel..B T
>..T U
(..U V
id..V X
)..X Y
;..Y Z
return00 
this00 
.00 
View00 
(00 

inputModel00 '
)00' (
;00( )
}11 	
[33 	
HttpPost33	 
]33 
[44 	
	Authorize44	 
]44 
public55 
async55 
Task55 
<55 
IActionResult55 '
>55' (
Edit55) -
(55- .
int55. 1
id552 4
,554 5
EventEditViewModel556 H

eventModel55I S
)55S T
{66 	
if77 
(77 
!77 
this77 
.77 

ModelState77  
.77  !
IsValid77! (
)77( )
{88 
return99 
this99 
.99 
View99  
(99  !
)99! "
;99" #
}:: 
var<< 
userId<< 
=<< 
this<< 
.<< 
User<< "
.<<" #
FindFirstValue<<# 1
(<<1 2

ClaimTypes<<2 <
.<<< =
NameIdentifier<<= K
)<<K L
;<<L M
await== 
this== 
.== 
eventService== #
.==# $
UpdateAsync==$ /
(==/ 0
id==0 2
,==2 3

eventModel==4 >
,==> ?
userId==@ F
)==F G
;==G H
return?? 
this?? 
.?? 
RedirectToAction?? (
(??( )
nameof??) /
(??/ 0
this??0 4
.??4 5
All??5 8
)??8 9
)??9 :
;??: ;
}@@ 	
[BB 	
	AuthorizeBB	 
]BB 
publicCC 
IActionResultCC 
DonateCC #
(CC# $
)CC$ %
{DD 	
returnEE 
thisEE 
.EE 
ViewEE 
(EE 
)EE 
;EE 
}FF 	
[HH 	
	AuthorizeHH	 
]HH 
publicII 
IActionResultII 
CreateII #
(II# $
)II$ %
{JJ 	
returnKK 
thisKK 
.KK 
ViewKK 
(KK 
)KK 
;KK 
}LL 	
[NN 	
HttpPostNN	 
]NN 
[OO 	
	AuthorizeOO	 
]OO 
publicPP 
asyncPP 
TaskPP 
<PP 
IActionResultPP '
>PP' (
CreatePP) /
(PP/ 0
EventInputViewModelPP0 C
modelPPD I
)PPI J
{QQ 	
ifRR 
(RR 
!RR 
thisRR 
.RR 

ModelStateRR  
.RR  !
IsValidRR! (
)RR( )
{SS 
returnTT 
thisTT 
.TT 
ViewTT  
(TT  !
)TT! "
;TT" #
}UU 
varWW 
userIdWW 
=WW 
thisWW 
.WW 
UserWW "
.WW" #
FindFirstValueWW# 1
(WW1 2

ClaimTypesWW2 <
.WW< =
NameIdentifierWW= K
)WWK L
;WWL M
awaitXX 
thisXX 
.XX 
eventServiceXX #
.XX# $
CreateAsyncXX$ /
(XX/ 0
modelXX0 5
,XX5 6
userIdXX7 =
)XX= >
;XX> ?
returnZZ 
thisZZ 
.ZZ 
RedirectToActionZZ (
(ZZ( )
nameofZZ) /
(ZZ/ 0
thisZZ0 4
.ZZ4 5
AllZZ5 8
)ZZ8 9
)ZZ9 :
;ZZ: ;
}[[ 	
[]] 	
	Authorize]]	 
]]] 
public^^ 
async^^ 
Task^^ 
<^^ 
IActionResult^^ '
>^^' (
Cancel^^) /
(^^/ 0
int^^0 3
id^^4 6
)^^6 7
{__ 	
var`` 
userId`` 
=`` 
this`` 
.`` 
User`` "
.``" #
FindFirstValue``# 1
(``1 2

ClaimTypes``2 <
.``< =
NameIdentifier``= K
)``K L
;``L M
awaitbb 
thisbb 
.bb 
eventServicebb #
.bb# $
CancelEventAsyncbb$ 4
(bb4 5
idbb5 7
,bb7 8
userIdbb9 ?
)bb? @
;bb@ A
returndd 
thisdd 
.dd 
RedirectToActiondd (
(dd( )
nameofdd) /
(dd/ 0
thisdd0 4
.dd4 5
Alldd5 8
)dd8 9
)dd9 :
;dd: ;
}ee 	
[gg 	
	Authorizegg	 
]gg 
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
Joinhh) -
(hh- .
inthh. 1
idhh2 4
)hh4 5
{ii 	
varjj 
userIdjj 
=jj 
thisjj 
.jj 
Userjj "
.jj" #
FindFirstValuejj# 1
(jj1 2

ClaimTypesjj2 <
.jj< =
NameIdentifierjj= K
)jjK L
;jjL M
awaitll 
thisll 
.ll 
eventServicell #
.ll# $
JoinEventAsyncll$ 2
(ll2 3
idll3 5
,ll5 6
userIdll7 =
)ll= >
;ll> ?
returnnn 
thisnn 
.nn 
RedirectToActionnn (
(nn( )
nameofnn) /
(nn/ 0
thisnn0 4
.nn4 5
Allnn5 8
)nn8 9
)nn9 :
;nn: ;
}oo 	
[qq 	
	Authorizeqq	 
]qq 
[rr 	
HttpPostrr	 
]rr 
publicss 
asyncss 
Taskss 
<ss 
IActionResultss '
>ss' (
Deletess) /
(ss/ 0
intss0 3
idss4 6
)ss6 7
{tt 	
varuu 
userIduu 
=uu 
thisuu 
.uu 
Useruu "
.uu" #
FindFirstValueuu# 1
(uu1 2

ClaimTypesuu2 <
.uu< =
NameIdentifieruu= K
)uuK L
;uuL M
awaitww 
thisww 
.ww 
eventServiceww #
.ww# $
DeleteByIdAsyncww$ 3
(ww3 4
idww4 6
,ww6 7
userIdww8 >
)ww> ?
;ww? @
returnyy 
thisyy 
.yy 
RedirectToActionyy (
(yy( )
nameofyy) /
(yy/ 0
thisyy0 4
.yy4 5
Allyy5 8
)yy8 9
)yy9 :
;yy: ;
}zz 	
}{{ 
}|| ì_
oC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\ForumController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
ForumController  
:! "
BaseController# 1
{ 
private 
readonly 
IPostservice %
postService& 1
;1 2
public 
ForumController 
( 
IPostservice +
postService, 7
)7 8
{ 	
this 
. 
postService 
= 
postService *
;* +
} 	
[ 	
	Authorize	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Details) 0
(0 1
int1 4
id5 7
)7 8
{ 	
var 
	viewModel 
= 
await !
this" &
.& '
postService' 2
.2 3
GetByIdAsync3 ?
<? @&
PostDetailsOutputViewModel@ Z
>Z [
([ \
id\ ^
)^ _
;_ `
if 
( 
	viewModel 
== 
null !
)! "
{ 
return 
this 
. 
NotFound $
($ %
)% &
;& '
} 
return   
this   
.   
View   
(   
	viewModel   &
)  & '
;  ' (
}!! 	
[## 	
	Authorize##	 
]## 
public$$ 
async$$ 
Task$$ 
<$$ 
IActionResult$$ '
>$$' (
Edit$$) -
($$- .
int$$. 1
id$$2 4
)$$4 5
{%% 	
var&& 

inputModel&& 
=&& 
await&& "
this&&# '
.&&' (
postService&&( 3
.&&3 4
GetByIdAsync&&4 @
<&&@ A
PostEditViewModel&&A R
>&&R S
(&&S T
id&&T V
)&&V W
;&&W X
return(( 
this(( 
.(( 
View(( 
((( 

inputModel(( '
)((' (
;((( )
})) 	
[++ 	
HttpPost++	 
]++ 
[,, 	
	Authorize,,	 
],, 
public-- 
async-- 
Task-- 
<-- 
IActionResult-- '
>--' (
Edit--) -
(--- .
int--. 1
id--2 4
,--4 5
PostEditViewModel--6 G
post--H L
)--L M
{.. 	
if// 
(// 
!// 
this// 
.// 

ModelState//  
.//  !
IsValid//! (
)//( )
{00 
return11 
this11 
.11 
View11  
(11  !
)11! "
;11" #
}22 
var44 
userId44 
=44 
this44 
.44 
User44 "
.44" #
FindFirstValue44# 1
(441 2

ClaimTypes442 <
.44< =
NameIdentifier44= K
)44K L
;44L M
await55 
this55 
.55 
postService55 "
.55" #
UpdateAsync55# .
(55. /
id55/ 1
,551 2
post553 7
,557 8
userId559 ?
)55? @
;55@ A
return77 
this77 
.77 
RedirectToAction77 (
(77( )
nameof77) /
(77/ 0
this770 4
.774 5
Details775 <
)77< =
,77= >
new77? B
{77C D
id77E G
}77H I
)77I J
;77J K
}88 	
[:: 	
	Authorize::	 
]:: 
public;; 
IActionResult;; 
Personal;; %
(;;% &
int;;& )
id;;* ,
=;;- .
$num;;/ 0
);;0 1
{<< 	
if== 
(== 
id== 
<=== 
$num== 
)== 
{>> 
return?? 
this?? 
.?? 
NotFound?? $
(??$ %
)??% &
;??& '
}@@ 
constBB 
intBB 
ItemsPerPageBB "
=BB# $
$numBB% &
;BB& '
varCC 
userdIdCC 
=CC 
thisCC 
.CC 
UserCC #
.CC# $
FindFirstValueCC$ 2
(CC2 3

ClaimTypesCC3 =
.CC= >
NameIdentifierCC> L
)CCL M
;CCM N
varEE 
	viewModelEE 
=EE 
newEE $
PostsListOutputViewModelEE  8
{FF 
ItemsPerPageGG 
=GG 
ItemsPerPageGG +
,GG+ ,

PageNumberHH 
=HH 
idHH 
,HH  
EntitiesCountII 
=II 
thisII  $
.II$ %
postServiceII% 0
.II0 1
GetCountPersonalII1 A
(IIA B
userdIdIIB I
)III J
,IIJ K
PostsJJ 
=JJ 
thisJJ 
.JJ 
postServiceJJ (
.JJ( )
GetAllPersonalJJ) 7
<JJ7 8
PostOutputViewModelJJ8 K
>JJK L
(JJL M
idJJM O
,JJO P
ItemsPerPageJJQ ]
,JJ] ^
userdIdJJ_ f
)JJf g
,JJg h
	AspActionKK 
=KK 
nameofKK "
(KK" #
thisKK# '
.KK' (
PersonalKK( 0
)KK0 1
,KK1 2
}LL 
;LL 
returnNN 
thisNN 
.NN 
ViewNN 
(NN 
	viewModelNN &
)NN& '
;NN' (
}OO 	
[QQ 	
	AuthorizeQQ	 
]QQ 
[RR 	
RouteRR	 
(RR 
$strRR 
)RR 
]RR 
publicSS 
IActionResultSS 
AllSS  
(SS  !
intSS! $
idSS% '
=SS( )
$numSS* +
)SS+ ,
{TT 	
ifUU 
(UU 
idUU 
<=UU 
$numUU 
)UU 
{VV 
returnWW 
thisWW 
.WW 
NotFoundWW $
(WW$ %
)WW% &
;WW& '
}XX 
constZZ 
intZZ 
ItemsPerPageZZ "
=ZZ# $
$numZZ% &
;ZZ& '
var\\ 
	viewModel\\ 
=\\ 
new\\ $
PostsListOutputViewModel\\  8
{]] 
ItemsPerPage^^ 
=^^ 
ItemsPerPage^^ +
,^^+ ,

PageNumber__ 
=__ 
id__ 
,__  
EntitiesCount`` 
=`` 
this``  $
.``$ %
postService``% 0
.``0 1
GetCount``1 9
(``9 :
)``: ;
,``; <
Postsaa 
=aa 
thisaa 
.aa 
postServiceaa (
.aa( )
GetAllaa) /
<aa/ 0
PostOutputViewModelaa0 C
>aaC D
(aaD E
idaaE G
,aaG H
ItemsPerPageaaI U
)aaU V
,aaV W
	AspActionbb 
=bb 
nameofbb "
(bb" #
thisbb# '
.bb' (
Allbb( +
)bb+ ,
,bb, -
}cc 
;cc 
returnee 
thisee 
.ee 
Viewee 
(ee 
	viewModelee &
)ee& '
;ee' (
}ff 	
[hh 	
	Authorizehh	 
]hh 
publicii 
IActionResultii 

Categoriesii '
(ii' (
intii( +
idii, .
=ii/ 0
$numii1 2
)ii2 3
{jj 	
ifkk 
(kk 
idkk 
<=kk 
$numkk 
)kk 
{ll 
returnmm 
thismm 
.mm 
NotFoundmm $
(mm$ %
)mm% &
;mm& '
}nn 
constpp 
intpp 
ItemsPerPagepp "
=pp# $
$numpp% &
;pp& '
varrr 
	viewModelrr 
=rr 
newrr $
PostsListOutputViewModelrr  8
{ss 
ItemsPerPagett 
=tt 
ItemsPerPagett +
,tt+ ,

PageNumberuu 
=uu 
iduu 
,uu  
EntitiesCountvv 
=vv 
thisvv  $
.vv$ %
postServicevv% 0
.vv0 1
GetCountvv1 9
(vv9 :
)vv: ;
,vv; <
Postsww 
=ww 
thisww 
.ww 
postServiceww (
.ww( )
GetAllww) /
<ww/ 0
PostOutputViewModelww0 C
>wwC D
(wwD E
idwwE G
,wwG H
ItemsPerPagewwI U
)wwU V
,wwV W
}xx 
;xx 
returnzz 
thiszz 
.zz 
Viewzz 
(zz 
	viewModelzz &
)zz& '
;zz' (
}{{ 	
[}} 	
	Authorize}}	 
]}} 
public~~ 
IActionResult~~ 
Create~~ #
(~~# $
)~~$ %
{ 	
return
ÄÄ 
this
ÄÄ 
.
ÄÄ 
View
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
HttpPost
ÉÉ	 
]
ÉÉ 
[
ÑÑ 	
	Authorize
ÑÑ	 
]
ÑÑ 
public
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
IActionResult
ÖÖ '
>
ÖÖ' (
Create
ÖÖ) /
(
ÖÖ/ 0 
PostInputViewModel
ÖÖ0 B
proposal
ÖÖC K
)
ÖÖK L
{
ÜÜ 	
if
áá 
(
áá 
!
áá 
this
áá 
.
áá 

ModelState
áá  
.
áá  !
IsValid
áá! (
)
áá( )
{
àà 
return
ââ 
this
ââ 
.
ââ 
View
ââ  
(
ââ  !
)
ââ! "
;
ââ" #
}
ää 
await
åå 
this
åå 
.
åå 
postService
åå "
.
åå" #
CreateAsync
åå# .
(
åå. /
proposal
åå/ 7
,
åå7 8
this
åå9 =
.
åå= >
User
åå> B
.
ååB C
FindFirstValue
ååC Q
(
ååQ R

ClaimTypes
ååR \
.
åå\ ]
NameIdentifier
åå] k
)
ååk l
)
åål m
;
ååm n
return
éé 
this
éé 
.
éé 
RedirectToAction
éé (
(
éé( )
nameof
éé) /
(
éé/ 0
this
éé0 4
.
éé4 5

Categories
éé5 ?
)
éé? @
)
éé@ A
;
ééA B
}
èè 	
[
ëë 	
HttpPost
ëë	 
]
ëë 
[
íí 	
	Authorize
íí	 
]
íí 
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
IActionResult
ìì '
>
ìì' (
Delete
ìì) /
(
ìì/ 0
int
ìì0 3
id
ìì4 6
)
ìì6 7
{
îî 	
var
ïï 
userId
ïï 
=
ïï 
this
ïï 
.
ïï 
User
ïï "
.
ïï" #
FindFirstValue
ïï# 1
(
ïï1 2

ClaimTypes
ïï2 <
.
ïï< =
NameIdentifier
ïï= K
)
ïïK L
;
ïïL M
await
óó 
this
óó 
.
óó 
postService
óó "
.
óó" #
DeleteByIdAsync
óó# 2
(
óó2 3
id
óó3 5
,
óó5 6
userId
óó7 =
)
óó= >
;
óó> ?
return
ôô 
this
ôô 
.
ôô 
RedirectToAction
ôô (
(
ôô( )
nameof
ôô) /
(
ôô/ 0
this
ôô0 4
.
ôô4 5

Categories
ôô5 ?
)
ôô? @
)
ôô@ A
;
ôôA B
}
öö 	
}
õõ 
}úú Ê
nC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\HomeController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public

 

class

 
HomeController

 
:

  !
BaseController

" 0
{ 
private 
readonly 
IHomeService %
homeStatistics& 4
;4 5
public 
HomeController 
( 
IHomeService *
homeStatistics+ 9
)9 :
{ 	
this 
. 
homeStatistics 
=  !
homeStatistics" 0
;0 1
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
var 
statisticsDto 
= 
this  $
.$ %
homeStatistics% 3
.3 4
	GetCounts4 =
(= >
)> ?
;? @
var 
	viewModel 
= 
new )
HomeStatisticsOutputViewModel  =
{ 
EventsCount 
= 
statisticsDto +
.+ ,
EventsCount, 7
,7 8

PostsCount 
= 
statisticsDto *
.* +

PostsCount+ 5
,5 6
ProposalsCount 
=  
statisticsDto! .
.. /
ProposalsCount/ =
,= >

UsersCount 
= 
statisticsDto *
.* +

UsersCount+ 5
,5 6
	NewsCount 
= 
statisticsDto )
.) *
	NewsCount* 3
,3 4
} 
; 
return   
this   
.   
View   
(   
	viewModel   &
)  & '
;  ' (
}!! 	
public## 
IActionResult## 
Privacy## $
(##$ %
)##% &
{$$ 	
return%% 
this%% 
.%% 
View%% 
(%% 
)%% 
;%% 
}&& 	
[(( 	
ResponseCache((	 
((( 
Duration(( 
=((  !
$num((" #
,((# $
Location((% -
=((. /!
ResponseCacheLocation((0 E
.((E F
None((F J
,((J K
NoStore((L S
=((T U
true((V Z
)((Z [
](([ \
public)) 
IActionResult)) 
Error)) "
())" #
)))# $
{** 	
return++ 
this++ 
.++ 
View++ 
(++ 
new,, 
ErrorViewModel,, "
{,,# $
	RequestId,,% .
=,,/ 0
Activity,,1 9
.,,9 :
Current,,: A
?,,A B
.,,B C
Id,,C E
??,,F H
this,,I M
.,,M N
HttpContext,,N Y
.,,Y Z
TraceIdentifier,,Z i
},,j k
),,k l
;,,l m
}-- 	
}.. 
}// ¿
oC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\LikesController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
LikesController  
:! "
BaseController# 1
{ 
private 
readonly 
ILikeService %
likeService& 1
;1 2
public 
LikesController 
( 
ILikeService +
likeService, 7
)7 8
{ 	
this 
. 
likeService 
= 
likeService *
;* +
} 	
[ 	
HttpPost	 
] 
[ 	
	Authorize	 
] 
public 
async 
Task 
< 
ActionResult &
<& '!
PostVoteResponseModel' <
>< =
>= >
Post? C
(C D"
PostLikeInputViewModelD Z
input[ `
)` a
{ 	
if 
( 
! 
this 
. 

ModelState  
.  !
IsValid! (
)( )
{ 
return 
this 
. 
View  
(  !
)! "
;" #
} 
var   
userId   
=   
this   
.   
User   "
.  " #
FindFirstValue  # 1
(  1 2

ClaimTypes  2 <
.  < =
NameIdentifier  = K
)  K L
;  L M
await"" 
this"" 
."" 
likeService"" "
.""" #
SetLikeAsync""# /
(""/ 0
input""0 5
.""5 6
PostId""6 <
,""< =
userId""> D
,""D E
input""F K
.""K L

IsPositive""L V
)""V W
;""W X
var$$ 
	voteModel$$ 
=$$ 
new$$ !
PostVoteResponseModel$$  5
{%% 
Likes&& 
=&& 
this&& 
.&& 
likeService&& (
.&&( )
GetLikes&&) 1
(&&1 2
input&&2 7
.&&7 8
PostId&&8 >
)&&> ?
,&&? @
	DissLikes'' 
='' 
this''  
.''  !
likeService''! ,
.'', -
GetDisslikes''- 9
(''9 :
input'': ?
.''? @
PostId''@ F
)''F G
,''G H
PostId(( 
=(( 
input(( 
.(( 
PostId(( %
,((% &
})) 
;)) 
return++ 
	voteModel++ 
;++ 
},, 	
}-- 
}.. –"
nC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\NewsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
NewsController 
:  !
BaseController" 0
{ 
private 
readonly #
IPhysNewsScarperService 0
newsService1 <
;< =
private 
readonly 
INewsService %
newsServiceData& 5
;5 6
public 
NewsController 
( #
IPhysNewsScarperService 5
newsService6 A
,A B
INewsServiceC O
newsServiceDataP _
)_ `
{ 	
this 
. 
newsService 
= 
newsService *
;* +
this 
. 
newsServiceData  
=! "
newsServiceData# 2
;2 3
} 	
public 
async 
Task 
< 
IActionResult '
>' (
All) ,
(, -
int- 0
id1 3
=4 5
$num6 7
)7 8
{ 	
const 
int 

constPages  
=! "
$num# $
;$ %
if 
( 
id 
== 
$num 
) 
{ 
await 
this 
. 
newsService &
.& '
ImportNewsAsync' 6
(6 7

constPages7 A
)A B
;B C
} 
if 
( 
id 
<= 
$num 
) 
{   
return!! 
this!! 
.!! 
NotFound!! $
(!!$ %
)!!% &
;!!& '
}"" 
const$$ 
int$$ 
ItemsPerPage$$ "
=$$# $
$num$$% &
;$$& '
var&& 
	viewModel&& 
=&& 
new&& #
NewsListOutputViewModel&&  7
{'' 
ItemsPerPage(( 
=(( 
ItemsPerPage(( +
,((+ ,

PageNumber)) 
=)) 
id)) 
,))  
EntitiesCount** 
=** 
this**  $
.**$ %
newsServiceData**% 4
.**4 5
GetCount**5 =
(**= >
)**> ?
,**? @
NewsList++ 
=++ 
this++ 
.++  
newsServiceData++  /
.++/ 0
GetAll++0 6
<++6 7
NewsOutputViewModel++7 J
>++J K
(++K L
id++L N
,++N O
ItemsPerPage++P \
)++\ ]
,++] ^
	AspAction,, 
=,, 
nameof,, "
(,," #
this,,# '
.,,' (
All,,( +
),,+ ,
,,,, -
}-- 
;-- 
return// 
this// 
.// 
View// 
(// 
	viewModel// &
)//& '
;//' (
}00 	
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (
Details22) 0
(220 1
int221 4
id225 7
)227 8
{33 	
var44 
model44 
=44 
await44 
this44 "
.44" #
newsServiceData44# 2
.442 3
GetByIdAsync443 ?
<44? @
NewsOutputViewModel44@ S
>44S T
(44T U
id44U W
)44W X
;44X Y
return66 
this66 
.66 
View66 
(66 
model66 "
)66" #
;66# $
}77 	
[99 	
	Authorize99	 
(99 
Roles99 
=99 
GlobalConstants99 *
.99* +!
AdministratorRoleName99+ @
)99@ A
]99A B
public:: 
IActionResult:: 
Refresh:: $
(::$ %
)::% &
{;; 	
return<< 
this<< 
.<< 
RedirectToAction<< (
(<<( )
nameof<<) /
(<</ 0
this<<0 4
.<<4 5
All<<5 8
)<<8 9
)<<9 :
;<<: ;
}== 	
}>> 
}?? ·t
sC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\ProposalsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
ProposalsController $
:% &
BaseController' 5
{ 
private 
readonly 
IProposalService )
proposalService* 9
;9 :
private 
readonly 
IWebHostEnvironment ,
environment- 8
;8 9
private 
readonly 
IEmailSender %
emailSender& 1
;1 2
public 
ProposalsController "
(" #
IProposalService# 3
proposalService4 C
,C D
IWebHostEnvironmentE X
environmentY d
,d e
IEmailSenderf r
emailSenders ~
)~ 
{ 	
this 
. 
proposalService  
=! "
proposalService# 2
;2 3
this 
. 
environment 
= 
environment *
;* +
this 
. 
emailSender 
= 
emailSender *
;* +
} 	
public 
IActionResult 
All  
(  !
int! $
id% '
=( )
$num* +
)+ ,
{   	
if!! 
(!! 
id!! 
<=!! 
$num!! 
)!! 
{"" 
return## 
this## 
.## 
NotFound## $
(##$ %
)##% &
;##& '
}$$ 
const&& 
int&& 
ItemsPerPage&& "
=&&# $
$num&&% &
;&&& '
var(( 
	viewModel(( 
=(( 
new(( (
ProposalsListOutputViewModel((  <
{)) 
ItemsPerPage** 
=** 
ItemsPerPage** +
,**+ ,

PageNumber++ 
=++ 
id++ 
,++  
EntitiesCount,, 
=,, 
this,,  $
.,,$ %
proposalService,,% 4
.,,4 5
GetCount,,5 =
(,,= >
),,> ?
,,,? @
	Proposals-- 
=-- 
this--  
.--  !
proposalService--! 0
.--0 1
GetAll--1 7
<--7 8#
ProposalOutputViewModel--8 O
>--O P
(--P Q
id--Q S
,--S T
ItemsPerPage--U a
)--a b
,--b c
	AspAction.. 
=.. 
nameof.. "
(.." #
this..# '
...' (
All..( +
)..+ ,
,.., -
}// 
;// 
return11 
this11 
.11 
View11 
(11 
	viewModel11 &
)11& '
;11' (
}22 	
[44 	
	Authorize44	 
]44 
public55 
async55 
Task55 
<55 
IActionResult55 '
>55' (
Edit55) -
(55- .
int55. 1
id552 4
)554 5
{66 	
var77 

inputModel77 
=77 
await77 "
this77# '
.77' (
proposalService77( 7
.777 8
GetByIdAsync778 D
<77D E!
ProposalEditViewModel77E Z
>77Z [
(77[ \
id77\ ^
)77^ _
;77_ `
return99 
this99 
.99 
View99 
(99 

inputModel99 '
)99' (
;99( )
}:: 	
[<< 	
HttpPost<<	 
]<< 
[== 	
	Authorize==	 
]== 
public>> 
async>> 
Task>> 
<>> 
IActionResult>> '
>>>' (
Edit>>) -
(>>- .
int>>. 1
id>>2 4
,>>4 5!
ProposalEditViewModel>>6 K
proposal>>L T
)>>T U
{?? 	
if@@ 
(@@ 
!@@ 
this@@ 
.@@ 

ModelState@@  
.@@  !
IsValid@@! (
)@@( )
{AA 
returnBB 
thisBB 
.BB 
ViewBB  
(BB  !
)BB! "
;BB" #
}CC 
varEE 
userIdEE 
=EE 
thisEE 
.EE 
UserEE "
.EE" #
FindFirstValueEE# 1
(EE1 2

ClaimTypesEE2 <
.EE< =
NameIdentifierEE= K
)EEK L
;EEL M
awaitFF 
thisFF 
.FF 
proposalServiceFF &
.FF& '
UpdateAsyncFF' 2
(FF2 3
idFF3 5
,FF5 6
proposalFF7 ?
,FF? @
userIdFFA G
)FFG H
;FFH I
returnHH 
thisHH 
.HH 
RedirectToActionHH (
(HH( )
nameofHH) /
(HH/ 0
thisHH0 4
.HH4 5
DetailsHH5 <
)HH< =
,HH= >
newHH? B
{HHC D
idHHE G
}HHH I
)HHI J
;HHJ K
}II 	
[KK 	
	AuthorizeKK	 
]KK 
publicLL 
IActionResultLL 
CreateLL #
(LL# $
)LL$ %
{MM 	
returnNN 
thisNN 
.NN 
ViewNN 
(NN 
)NN 
;NN 
}OO 	
[QQ 	
	AuthorizeQQ	 
]QQ 
[RR 	
HttpPostRR	 
]RR 
publicSS 
asyncSS 
TaskSS 
<SS 
IActionResultSS '
>SS' (
CreateSS) /
(SS/ 0
ProposalViewModelSS0 A
proposalSSB J
)SSJ K
{TT 	
ifUU 
(UU 
!UU 
thisUU 
.UU 

ModelStateUU  
.UU  !
IsValidUU! (
)UU( )
{VV 
returnWW 
thisWW 
.WW 
ViewWW  
(WW  !
)WW! "
;WW" #
}XX 
var[[ 
userId[[ 
=[[ 
this[[ 
.[[ 
User[[ "
.[[" #
FindFirstValue[[# 1
([[1 2

ClaimTypes[[2 <
.[[< =
NameIdentifier[[= K
)[[K L
;[[L M
var\\ 

pathImages\\ 
=\\ 
$"\\ 
{\\  
this\\  $
.\\$ %
environment\\% 0
.\\0 1
WebRootPath\\1 <
}\\< =
$str\\= D
"\\D E
;\\E F
try^^ 
{__ 
await`` 
this`` 
.`` 
proposalService`` *
.``* +
CreateAsync``+ 6
(``6 7
proposal``7 ?
,``? @
userId``A G
,``G H

pathImages``I S
)``S T
;``T U
}aa 
catchbb 
(bb 
	Exceptionbb 
exbb 
)bb  
{cc 
thisdd 
.dd 

ModelStatedd 
.dd  
AddModelErrordd  -
(dd- .
stringdd. 4
.dd4 5
Emptydd5 :
,dd: ;
exdd< >
.dd> ?
Messagedd? F
)ddF G
;ddG H
returnee 
thisee 
.ee 
Viewee  
(ee  !
proposalee! )
)ee) *
;ee* +
}ff 
returnhh 
thishh 
.hh 
Redirecthh  
(hh  !
nameofhh! '
(hh' (
thishh( ,
.hh, -
Allhh- 0
)hh0 1
)hh1 2
;hh2 3
}ii 	
publickk 
asynckk 
Taskkk 
<kk 
IActionResultkk '
>kk' (
Detailskk) 0
(kk0 1
intkk1 4
idkk5 7
)kk7 8
{ll 	
varmm 
modelmm 
=mm 
awaitmm 
thismm "
.mm" #
proposalServicemm# 2
.mm2 3
GetByIdAsyncmm3 ?
<mm? @*
ProposalDetailsOutputViewModelmm@ ^
>mm^ _
(mm_ `
idmm` b
)mmb c
;mmc d
returnnn 
thisnn 
.nn 
Viewnn 
(nn 
modelnn "
)nn" #
;nn# $
}oo 	
[qq 	
	Authorizeqq	 
]qq 
publicrr 
IActionResultrr 
Personalrr %
(rr% &
intrr& )
idrr* ,
=rr- .
$numrr/ 0
)rr0 1
{ss 	
iftt 
(tt 
idtt 
<=tt 
$numtt 
)tt 
{uu 
returnvv 
thisvv 
.vv 
NotFoundvv $
(vv$ %
)vv% &
;vv& '
}ww 
constyy 
intyy 
ItemsPerPageyy "
=yy# $
$numyy% &
;yy& '
varzz 
userdIdzz 
=zz 
thiszz 
.zz 
Userzz #
.zz# $
FindFirstValuezz$ 2
(zz2 3

ClaimTypeszz3 =
.zz= >
NameIdentifierzz> L
)zzL M
;zzM N
var|| 
	viewModel|| 
=|| 
new|| (
ProposalsListOutputViewModel||  <
{}} 
ItemsPerPage~~ 
=~~ 
ItemsPerPage~~ +
,~~+ ,

PageNumber 
= 
id 
,  
EntitiesCount
ÄÄ 
=
ÄÄ 
this
ÄÄ  $
.
ÄÄ$ %
proposalService
ÄÄ% 4
.
ÄÄ4 5
GetCountPersonal
ÄÄ5 E
(
ÄÄE F
userdId
ÄÄF M
)
ÄÄM N
,
ÄÄN O
	Proposals
ÅÅ 
=
ÅÅ 
this
ÅÅ  
.
ÅÅ  !
proposalService
ÅÅ! 0
.
ÅÅ0 1
GetAllPersonal
ÅÅ1 ?
<
ÅÅ? @%
ProposalOutputViewModel
ÅÅ@ W
>
ÅÅW X
(
ÅÅX Y
id
ÅÅY [
,
ÅÅ[ \
ItemsPerPage
ÅÅ] i
,
ÅÅi j
userdId
ÅÅk r
)
ÅÅr s
,
ÅÅs t
	AspAction
ÇÇ 
=
ÇÇ 
nameof
ÇÇ "
(
ÇÇ" #
this
ÇÇ# '
.
ÇÇ' (
Personal
ÇÇ( 0
)
ÇÇ0 1
,
ÇÇ1 2
}
ÉÉ 
;
ÉÉ 
return
ÖÖ 
this
ÖÖ 
.
ÖÖ 
View
ÖÖ 
(
ÖÖ 
	viewModel
ÖÖ &
)
ÖÖ& '
;
ÖÖ' (
}
ÜÜ 	
[
àà 	
	Authorize
àà	 
]
àà 
[
ââ 	
HttpPost
ââ	 
]
ââ 
public
ää 
async
ää 
Task
ää 
<
ää 
IActionResult
ää '
>
ää' (
Delete
ää) /
(
ää/ 0
int
ää0 3
id
ää4 6
)
ää6 7
{
ãã 	
var
åå 
userId
åå 
=
åå 
this
åå 
.
åå 
User
åå "
.
åå" #
FindFirstValue
åå# 1
(
åå1 2

ClaimTypes
åå2 <
.
åå< =
NameIdentifier
åå= K
)
ååK L
;
ååL M
await
éé 
this
éé 
.
éé 
proposalService
éé &
.
éé& '
DeleteByIdAsync
éé' 6
(
éé6 7
id
éé7 9
,
éé9 :
userId
éé; A
)
ééA B
;
ééB C
return
êê 
this
êê 
.
êê 
RedirectToAction
êê (
(
êê( )
nameof
êê) /
(
êê/ 0
this
êê0 4
.
êê4 5
All
êê5 8
)
êê8 9
)
êê9 :
;
êê: ;
}
ëë 	
[
ìì 	
HttpPost
ìì	 
]
ìì 
public
îî 
async
îî 
Task
îî 
<
îî 
IActionResult
îî '
>
îî' (
SendToEmail
îî) 4
(
îî4 5
int
îî5 8
id
îî9 ;
)
îî; <
{
ïï 	
var
ññ 
targetEmail
ññ 
=
ññ 
this
ññ "
.
ññ" #
User
ññ# '
.
ññ' (
FindFirstValue
ññ( 6
(
ññ6 7

ClaimTypes
ññ7 A
.
ññA B
Email
ññB G
)
ññG H
;
ññH I
var
òò 
proposal
òò 
=
òò 
await
òò  
this
òò! %
.
òò% &
proposalService
òò& 5
.
òò5 6
GetByIdAsync
òò6 B
<
òòB C,
ProposalDetailsOutputViewModel
òòC a
>
òòa b
(
òòb c
id
òòc e
)
òòe f
;
òòf g
var
ôô 
html
ôô 
=
ôô 
new
ôô 
StringBuilder
ôô (
(
ôô( )
)
ôô) *
;
ôô* +
html
õõ 
.
õõ 

AppendLine
õõ 
(
õõ 
$"
õõ 
$str
õõ "
{
õõ" #
proposal
õõ# +
.
õõ+ ,
Title
õõ, 1
}
õõ1 2
$str
õõ2 7
"
õõ7 8
)
õõ8 9
;
õõ9 :
html
úú 
.
úú 

AppendLine
úú 
(
úú 
$"
úú 
$str
úú "
{
úú" #
proposal
úú# +
.
úú+ ,
ShortDescription
úú, <
}
úú< =
$str
úú= B
"
úúB C
)
úúC D
;
úúD E
html
ùù 
.
ùù 

AppendLine
ùù 
(
ùù 
$"
ùù 
$str
ùù )
{
ùù) *
proposal
ùù* 2
.
ùù2 3
Images
ùù3 9
}
ùù9 :
$str
ùù: ?
"
ùù? @
)
ùù@ A
;
ùùA B
html
ûû 
.
ûû 

AppendLine
ûû 
(
ûû 
$"
ûû 
$str
ûû "
{
ûû" #
proposal
ûû# +
.
ûû+ ,
Description
ûû, 7
}
ûû7 8
$str
ûû8 =
"
ûû= >
)
ûû> ?
;
ûû? @
await
†† 
this
†† 
.
†† 
emailSender
†† "
.
††" #
SendEmailAsync
††# 1
(
††1 2
GlobalConstants
°° 
.
°°   
AdministratorEmail
°°  2
,
°°2 3
GlobalConstants
¢¢ 
.
¢¢  

SystemName
¢¢  *
,
¢¢* +
targetEmail
££ 
,
££ 
proposal
§§ 
.
§§ 
Title
§§ 
,
§§ 
html
•• 
.
•• 
ToString
•• 
(
•• 
)
•• 
)
••  
;
••  !
return
ßß 
this
ßß 
.
ßß 
RedirectToAction
ßß (
(
ßß( )
nameof
ßß) /
(
ßß/ 0
this
ßß0 4
.
ßß4 5
Details
ßß5 <
)
ßß< =
,
ßß= >
new
ßß? B
{
ßßC D
id
ßßE G
}
ßßH I
)
ßßI J
;
ßßJ K
}
®® 	
}
©© 
}™™ »
rC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\SettingsController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
public 

class 
SettingsController #
:$ %
BaseController& 4
{ 
private 
readonly 
ISettingsService )
settingsService* 9
;9 :
private 
readonly &
IDeletableEntityRepository 3
<3 4
Setting4 ;
>; <

repository= G
;G H
public 
SettingsController !
(! "
ISettingsService" 2
settingsService3 B
,B C&
IDeletableEntityRepositoryD ^
<^ _
Setting_ f
>f g

repositoryh r
)r s
{ 	
this 
. 
settingsService  
=! "
settingsService# 2
;2 3
this 
. 

repository 
= 

repository (
;( )
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
var 
settings 
= 
this 
.  
settingsService  /
./ 0
GetAll0 6
<6 7
SettingViewModel7 G
>G H
(H I
)I J
;J K
var 
model 
= 
new !
SettingsListViewModel 1
{2 3
Settings4 <
== >
settings? G
}H I
;I J
return 
this 
. 
View 
( 
model "
)" #
;# $
} 	
public 
async 
Task 
< 
IActionResult '
>' (
InsertSetting) 6
(6 7
)7 8
{   	
var!! 
random!! 
=!! 
new!! 
Random!! #
(!!# $
)!!$ %
;!!% &
var"" 
setting"" 
="" 
new"" 
Setting"" %
{""& '
Name""( ,
=""- .
$"""/ 1
$str""1 6
{""6 7
random""7 =
.""= >
Next""> B
(""B C
)""C D
}""D E
"""E F
,""F G
Value""H M
=""N O
$"""P R
$str""R X
{""X Y
random""Y _
.""_ `
Next""` d
(""d e
)""e f
}""f g
"""g h
}""i j
;""j k
await$$ 
this$$ 
.$$ 

repository$$ !
.$$! "
AddAsync$$" *
($$* +
setting$$+ 2
)$$2 3
;$$3 4
await%% 
this%% 
.%% 

repository%% !
.%%! "
SaveChangesAsync%%" 2
(%%2 3
)%%3 4
;%%4 5
return'' 
this'' 
.'' 
RedirectToAction'' (
(''( )
nameof'') /
(''/ 0
this''0 4
.''4 5
Index''5 :
)'': ;
)''; <
;''< =
}(( 	
})) 
}** ˘
oC:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Controllers\VotesController.cs
	namespace 	
GreenCap
 
. 
Web 
. 
Controllers "
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
VotesController  
:! "
BaseController# 1
{ 
private 
readonly 
IVotesService &
votesService' 3
;3 4
public 
VotesController 
( 
IVotesService ,
votesService- 9
)9 :
{ 	
this 
. 
votesService 
= 
votesService  ,
;, -
} 	
[ 	
HttpPost	 
] 
[ 	
	Authorize	 
] 
public 
async 
Task 
< 
ActionResult &
<& ' 
ProposalVoteResponse' ;
>; <
>< =
Post> B
(B C"
ProposalVoteInputModelC Y
inputZ _
)_ `
{ 	
if 
( 
! 
this 
. 

ModelState  
.  !
IsValid! (
)( )
{ 
return 
this 
. 
View  
(  !
)! "
;" #
} 
var   
userId   
=   
this   
.   
User   "
.  " #
FindFirstValue  # 1
(  1 2

ClaimTypes  2 <
.  < =
NameIdentifier  = K
)  K L
;  L M
await"" 
this"" 
."" 
votesService"" #
.""# $
SetVoteAsync""$ 0
(""0 1
input""1 6
.""6 7

ProposalId""7 A
,""A B
userId""C I
,""I J
input""K P
.""P Q
Value""Q V
)""V W
;""W X
var$$ 
averageVotes$$ 
=$$ 
this$$ #
.$$# $
votesService$$$ 0
.$$0 1
GetAverageVotes$$1 @
($$@ A
input$$A F
.$$F G

ProposalId$$G Q
)$$Q R
;$$R S
return&& 
new&&  
ProposalVoteResponse&& +
{&&, -
AverageVote&&. 9
=&&: ;
averageVotes&&< H
}&&I J
;&&J K
}'' 	
}(( 
})) Â

[C:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Program.cs
	namespace 	
GreenCap
 
. 
Web 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
CreateHostBuilder

 
(

 
args

 "
)

" #
.

# $
Build

$ )
(

) *
)

* +
.

+ ,
Run

, /
(

/ 0
)

0 1
;

1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder "
." #

UseStartup# -
<- .
Startup. 5
>5 6
(6 7
)7 8
;8 9
} 
) 
; 
} 
} í_
[C:\Users\dimit\Desktop\Dido\Programming\SoftUni-Web-Project\src\Web\GreenCap.Web\Startup.cs
	namespace 	
GreenCap
 
. 
Web 
{ 
public 

class 
Startup 
{ 
private 
readonly 
IConfiguration '
configuration( 5
;5 6
private 
readonly 
IWebHostEnvironment ,
environment- 8
;8 9
public 
Startup 
( 
IConfiguration %
configuration& 3
,3 4
IWebHostEnvironment5 H
environmentI T
)T U
{   	
this!! 
.!! 
configuration!! 
=!!  
configuration!!! .
;!!. /
this"" 
."" 
environment"" 
="" 
environment"" *
;""* +
}## 	
public-- 
void-- 
ConfigureServices-- %
(--% &
IServiceCollection--& 8
services--9 A
)--A B
{.. 	
services// 
.// 
AddDbContext// !
<//! " 
IDeletableRepository//" 6
>//6 7
(//7 8
options00 
=>00 
options00 "
.00" #
UseSqlServer00# /
(00/ 0
this000 4
.004 5
configuration005 B
.00B C
GetConnectionString00C V
(00V W
$str00W j
)00j k
)00k l
)00l m
;00m n
if22 
(22 
this22 
.22 
environment22  
.22  !
IsDevelopment22! .
(22. /
)22/ 0
)220 1
{33 
services44 
.44 
AddDefaultIdentity44 +
<44+ ,
ApplicationUser44, ;
>44; <
(44< =#
IdentityOptionsProvider44= T
.44T U)
GetIdentityOptionsDevelopment44U r
)44r s
.55 
AddRoles55 !
<55! "
ApplicationRole55" 1
>551 2
(552 3
)553 4
.554 5$
AddEntityFrameworkStores555 M
<55M N 
IDeletableRepository55N b
>55b c
(55c d
)55d e
;55e f
}66 
else77 
if77 
(77 
this77 
.77 
environment77 %
.77% &
IsProduction77& 2
(772 3
)773 4
)774 5
{88 
services99 
.99 
AddDefaultIdentity99 +
<99+ ,
ApplicationUser99, ;
>99; <
(99< =#
IdentityOptionsProvider99= T
.99T U(
GetIdentityOptionsProduction99U q
)99q r
.:: 
AddRoles:: !
<::! "
ApplicationRole::" 1
>::1 2
(::2 3
)::3 4
.::4 5$
AddEntityFrameworkStores::5 M
<::M N 
IDeletableRepository::N b
>::b c
(::c d
)::d e
;::e f
};; 
services== 
.== 
	Configure== 
<== 
CookiePolicyOptions== 2
>==2 3
(==3 4
options>> 
=>>> 
{?? 
options@@ 
.@@  
CheckConsentNeeded@@  2
=@@3 4
context@@5 <
=>@@= ?
true@@@ D
;@@D E
optionsAA 
.AA  !
MinimumSameSitePolicyAA  5
=AA6 7
SameSiteModeAA8 D
.AAD E
NoneAAE I
;AAI J
}BB 
)BB 
;BB 
servicesDD 
.DD #
AddControllersWithViewsDD ,
(DD, -
optionsEE 
=>EE 
{FF 
optionsGG 
.GG  
FiltersGG  '
.GG' (
AddGG( +
(GG+ ,
newGG, /1
%AutoValidateAntiforgeryTokenAttributeGG0 U
(GGU V
)GGV W
)GGW X
;GGX Y
}HH 
)HH 
.HH &
AddRazorRuntimeCompilationHH 1
(HH1 2
)HH2 3
;HH3 4
servicesII 
.II 
AddRazorPagesII "
(II" #
)II# $
;II$ %
servicesKK 
.KK 3
'AddDatabaseDeveloperPageExceptionFilterKK <
(KK< =
)KK= >
;KK> ?
servicesMM 
.MM 
AddAntiforgeryMM #
(MM# $
optionsMM$ +
=>MM, .
{NN 
optionsOO 
.OO 

HeaderNameOO "
=OO# $
$strOO% 3
;OO3 4
}PP 
)PP 
;PP 
servicesRR 
.RR 
AddSingletonRR !
(RR! "
thisRR" &
.RR& '
configurationRR' 4
)RR4 5
;RR5 6
servicesUU 
.UU 
	AddScopedUU 
(UU 
typeofUU %
(UU% &&
IDeletableEntityRepositoryUU& @
<UU@ A
>UUA B
)UUB C
,UUC D
typeofUUE K
(UUK L'
EfDeletableEntityRepositoryUUL g
<UUg h
>UUh i
)UUi j
)UUj k
;UUk l
servicesVV 
.VV 
	AddScopedVV 
(VV 
typeofVV %
(VV% &
IRepositoryVV& 1
<VV1 2
>VV2 3
)VV3 4
,VV4 5
typeofVV6 <
(VV< =
EfRepositoryVV= I
<VVI J
>VVJ K
)VVK L
)VVL M
;VVM N
servicesWW 
.WW 
	AddScopedWW 
<WW 
IDbQueryRunnerWW -
,WW- .
DbQueryRunnerWW/ <
>WW< =
(WW= >
)WW> ?
;WW? @
servicesZZ 
.ZZ 
AddTransientZZ !
<ZZ! "
IEmailSenderZZ" .
>ZZ. /
(ZZ/ 0
xZZ0 1
=>ZZ2 4
newZZ5 8
SendGridEmailSenderZZ9 L
(ZZL M
thisZZM Q
.ZZQ R
configurationZZR _
[ZZ_ `
$strZZ` q
]ZZq r
)ZZr s
)ZZs t
;ZZt u
services[[ 
.[[ 
AddTransient[[ !
<[[! "
ISettingsService[[" 2
,[[2 3
SettingsService[[4 C
>[[C D
([[D E
)[[E F
;[[F G
services\\ 
.\\ 
AddTransient\\ !
<\\! "
IProposalService\\" 2
,\\2 3
ProposalService\\4 C
>\\C D
(\\D E
)\\E F
;\\F G
services]] 
.]] 
AddTransient]] !
<]]! "
IPostservice]]" .
,]]. /
PostService]]0 ;
>]]; <
(]]< =
)]]= >
;]]> ?
services^^ 
.^^ 
AddTransient^^ !
<^^! "
IHomeService^^" .
,^^. /
HomeService^^0 ;
>^^; <
(^^< =
)^^= >
;^^> ?
services__ 
.__ 
AddTransient__ !
<__! "#
IPhysNewsScarperService__" 9
,__9 :"
PhysNewsScarperService__; Q
>__Q R
(__R S
)__S T
;__T U
services`` 
.`` 
AddTransient`` !
<``! "
INewsService``" .
,``. /
NewsService``0 ;
>``; <
(``< =
)``= >
;``> ?
servicesaa 
.aa 
AddTransientaa !
<aa! "
ILikeServiceaa" .
,aa. /
PostLikeServiceaa0 ?
>aa? @
(aa@ A
)aaA B
;aaB C
servicesbb 
.bb 
AddTransientbb !
<bb! "
IVotesServicebb" /
,bb/ 0
VotesServicebb1 =
>bb= >
(bb> ?
)bb? @
;bb@ A
servicescc 
.cc 
AddTransientcc !
<cc! "
ICommentsServicecc" 2
,cc2 3
CommentsServicecc4 C
>ccC D
(ccD E
)ccE F
;ccF G
servicesdd 
.dd 
AddTransientdd !
<dd! "
IChartServicedd" /
,dd/ 0
ChartServicedd1 =
>dd= >
(dd> ?
)dd? @
;dd@ A
servicesee 
.ee 
AddTransientee !
<ee! "
IEventServiceee" /
,ee/ 0
EventServiceee1 =
>ee= >
(ee> ?
)ee? @
;ee@ A
}hh 	
publickk 
voidkk 
	Configurekk 
(kk 
IApplicationBuilderkk 1
appkk2 5
,kk5 6
IWebHostEnvironmentkk7 J
envkkK N
)kkN O
{ll 	
AutoMapperConfigmm 
.mm 
RegisterMappingsmm -
(mm- .
typeofmm. 4
(mm4 5
ErrorViewModelmm5 C
)mmC D
.mmD E
GetTypeInfommE P
(mmP Q
)mmQ R
.mmR S
AssemblymmS [
)mm[ \
;mm\ ]
usingpp 
(pp 
varpp 
serviceScopepp #
=pp$ %
apppp& )
.pp) *
ApplicationServicespp* =
.pp= >
CreateScopepp> I
(ppI J
)ppJ K
)ppK L
{qq 
varrr 
	dbContextrr 
=rr 
serviceScoperr  ,
.rr, -
ServiceProviderrr- <
.rr< =
GetRequiredServicerr= O
<rrO P 
IDeletableRepositoryrrP d
>rrd e
(rre f
)rrf g
;rrg h
	dbContextss 
.ss 
Databasess "
.ss" #
Migratess# *
(ss* +
)ss+ ,
;ss, -
newtt &
ApplicationDbContextSeedertt .
(tt. /
)tt/ 0
.tt0 1
	SeedAsynctt1 :
(tt: ;
	dbContexttt; D
,ttD E
serviceScopettF R
.ttR S
ServiceProviderttS b
)ttb c
.ttc d

GetAwaiterttd n
(ttn o
)tto p
.ttp q
	GetResultttq z
(ttz {
)tt{ |
;tt| }
}uu 
ifxx 
(xx 
envxx 
.xx 
IsDevelopmentxx !
(xx! "
)xx" #
)xx# $
{yy 
appzz 
.zz %
UseDeveloperExceptionPagezz -
(zz- .
)zz. /
;zz/ 0
app{{ 
.{{ !
UseMigrationsEndPoint{{ )
({{) *
){{* +
;{{+ ,
}|| 
else}} 
{~~ 
app 
. 
UseExceptionHandler '
(' (
$str( 5
)5 6
;6 7
app
ÄÄ 
.
ÄÄ 
UseHsts
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
app
ÑÑ 
.
ÑÑ !
UseHttpsRedirection
ÑÑ #
(
ÑÑ# $
)
ÑÑ$ %
;
ÑÑ% &
app
ÖÖ 
.
ÖÖ 
UseStaticFiles
ÖÖ 
(
ÖÖ 
)
ÖÖ  
;
ÖÖ  !
app
ÜÜ 
.
ÜÜ 
UseCookiePolicy
ÜÜ 
(
ÜÜ  
)
ÜÜ  !
;
ÜÜ! "
app
àà 
.
àà 

UseRouting
àà 
(
àà 
)
àà 
;
àà 
app
ää 
.
ää 
UseAuthentication
ää !
(
ää! "
)
ää" #
;
ää# $
app
ãã 
.
ãã 
UseAuthorization
ãã  
(
ãã  !
)
ãã! "
;
ãã" #
app
çç 
.
çç 
UseEndpoints
çç 
(
çç 
	endpoints
éé 
=>
éé 
{
èè 
	endpoints
êê !
.
êê! " 
MapControllerRoute
êê" 4
(
êê4 5
$str
êê5 @
,
êê@ A
$str
êêB x
)
êêx y
;
êêy z
	endpoints
ëë !
.
ëë! " 
MapControllerRoute
ëë" 4
(
ëë4 5
$str
ëë5 >
,
ëë> ?
$str
ëë@ h
)
ëëh i
;
ëëi j
	endpoints
íí !
.
íí! "
MapRazorPages
íí" /
(
íí/ 0
)
íí0 1
;
íí1 2
}
ìì 
)
ìì 
;
ìì 
}
îî 	
}
ïï 
}ññ 